"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8773],{81870:(e,t,i)=>{i.d(t,{Z:()=>p});var n=i(23174),o=i.n(n),l=(i(67294),i(83355)),r=i(84169),s=i(50906),a=i(73063),c=i(16354);class d extends l.Z{renderComponent(){return o()(c.Z,{href:this.props.href,external:!0,onClick:()=>s.Fsx(this.environment,{from:this.props.helpButtonContext})},void 0,o()(a.Z,{icon:r.m,style:{height:24,width:24,marginRight:-6,fill:this.theme.mediumIconColor}}))}}d.displayName="CollectionMenuHelpButton";const p=d},91496:(e,t,i)=>{i.d(t,{Z:()=>z});var n=i(23174),o=i.n(n),l=i(10434),r=i.n(l),s=i(67294),a=i(83355),c=i(15145),d=i(58573),p=i(47453),m=i(35840),h=i(72126),u=i(5366),g=i(50906),v=i(98834),y=i(75018),S=i(21325),f=i(39699),C=i(66890),k=i(66213),x=i(14976),b=i(75079),M=i(84210),w=i(33929),T=i(87279),Z=i(18514),_=i(80444),I=i(33846),P=i(29798),B=i(57559),L=i(13401),F=i(81870),E=i(40071),R=i(44514),V=i(79131),N=i(68894),A=i(78140),D=i(28992),K=i(32163),O=i(40721),Q=i(72495),H=i(34574);const U=(0,u.defineMessages)({filterPlaceholder:{id:"collectionPicker.searchBarFilter.text",defaultMessage:"Filter…"}});class Y extends a.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:P.Z,templateInputStore:I.Z},this.handleTemplateFilterChange=e=>{const{templateInputStore:t}=this.stores;t.setState({...t.state,inputValue:e.currentTarget.value})},this.renderMenuList=(e,t,i)=>{var n;const{device:l}=this.environment,{canConfigureCollection:a,isOverlay:c}=this.props,{templateInputStore:d}=this.stores,p={key:"create-template",render:(e,t)=>this.renderNewButtonMenuItem(e),action:this.handleNewCollectionTemplateClick},m=null===(n=this.context.collectionContextStore)||void 0===n?void 0:n.defaultPageTemplateStore.state,u={key:"empty",render:(t,i)=>{if(0!==e.length&&""===d.state.inputValue)return s.createElement(E.Z,r()({},this.props,{templateStore:void 0,isMobile:this.environment.device.isMobile,locked:this.props.locked||!a,draggable:!0,isDefault:void 0===(null==m?void 0:m.id),onCancelClick:this.props.onCancelClick},t))},action:this.handleEmptyPageContinueClick};return o()(K.Z,{type:K.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:this.handleEmptyEnter,sections:h.oA([0!==e.length&&{key:"templates",render:t=>{const n=t.children.slice(0,t.children.length-1),a=t.children[t.children.length-1];return s.createElement(Q.Z,r()({},t,{disableDesktopPadding:!this.props.isOverlay,disableMobileBorders:!0,children:o()(s.Fragment,{},void 0,l.isMobile||this.props.locked||!this.props.canConfigureCollection?n.map(((e,t)=>n[t])):o()(V.ZP,{direction:"vertical",keys:e,disabled:!i,renderKey:(t,i)=>n[e.indexOf(t)],onDrop:this.handleCollectionTemplatesReorder}),a)}))},items:[...t.map((e=>this.renderCollectionTemplatePageMenuItem(e,i))),u]},a?{key:"create-template",render:e=>s.createElement(Q.Z,r()({topBorder:c,disableDesktopPadding:!c,disableMobileBorders:!0},e)),items:[p]}:void 0])})},this.renderCollectionTemplatePageMenuItem=(e,t)=>{var i;const{device:n}=this.environment,{collectionStore:o,canConfigureCollection:l,locked:a}=this.props,c=null===(i=this.context.collectionContextStore)||void 0===i?void 0:i.defaultPageTemplateStore.state,d=B.Mz.fromBlockStore(e),p=null!=d&&d.isActive()?d.getRecurrence():void 0;return{key:e.id,render:i=>s.createElement(E.Z,r()({},i,{key:e.id,isOverlay:this.props.isOverlay,collectionStore:o,canConfigureCollection:l,templateStore:e,isMobile:n.isMobile,locked:a,onCancelClick:this.props.onCancelClick,draggable:t,isDefault:(null==c?void 0:c.id)===e.id,recurrence:p})),action:t=>{S.M_(this.environment)&&this.props.onTemplateClick({templateStore:e,isKeyboard:"keydown"===t.event.type})}}},this.handleEmptyPageContinueClick=e=>{const{collectionContextStore:t}=this.context;S.M_(this.environment)&&(this.props.onEmptyPageClick(),g.rNQ(this.environment,{template_name:"empty",is_keyboard:"keydown"===e.event.type,...t&&(0,b.Pn)(t)}))},this.handleEmptyEnter=()=>{const{collectionStore:e}=this.props;var t;S.M_(this.environment)&&(this.props.onEmptyEnter(),g.rNQ(this.environment,{template_name:"empty",is_keyboard:!0,collection_id:e.id,collection_view_id:null===(t=this.context.collectionContextStore)||void 0===t||null===(t=t.collectionViewStore())||void 0===t?void 0:t.id}))},this.handleNewCollectionTemplateClick=()=>{var e,t;const{collectionStore:i}=this.props,{templateInputStore:n}=this.stores;if(S.M_(this.environment)){var o;const{performResult:e}=f.createAndCommit({userAction:"CollectionTemplatePicker.newPage",environment:this.environment,perform:e=>v.nx({environment:this.environment,collectionStore:i,transaction:e,title:n?n.state.inputValue:void 0})});e&&this.navigateToBlock(e),g.dZq(this.environment,{collection_id:i.id,collection_view_id:null===(o=this.context.collectionContextStore)||void 0===o||null===(o=o.collectionViewStore())||void 0===o?void 0:o.id})}null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t)},this.handleCollectionTemplatesReorder=e=>{const{collectionStore:t}=this.props,{menuListStore:i}=this.stores;i.unsetFocus(),f.createAndCommit({userAction:"CollectionTemplatePicker.handleCollectionTemplatesReorder",environment:this.environment,perform:i=>v.$p({collectionStore:t,newTemplateIds:e,transaction:i})})}}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):y.navigate({environment:this.environment,url:e})}renderComponent(){const{device:e}=this.environment,{collectionStore:t,isOverlay:i}=this.props;let n=t.getTemplatePageStores();const{templateInputStore:l}=this.stores;if(!n.every((e=>e.isReady())))return;n=n.filter((e=>e.getAlive()));const a=n.map((e=>e.id));let c=this.renderMenuList(a,n,!0);const p=this.renderInputHeader();if(i){let t;t=e.isMobile?{menuType:T.og.Modal,title:o()(u.FormattedMessage,{defaultMessage:"Database templates",id:"database.mobileTemplatesMenu.title"}),left:o()(O.CancelMenuText,{}),onClickLeft:this.props.onCancelClick}:{menuType:T.og.Popup,width:360};let i=n,m=a;return a.length>6&&l.state.inputValue&&(i=(0,d.ZP)(l.state.inputValue,n,(e=>String(e.getProperties().title)??"")),m=i.map((e=>e.id)),c=this.renderMenuList(m,i,!1)),s.createElement(A.Z,r()({},t,{header:this.renderTitle()}),0===a.length&&o()(Q.Z,{},void 0,o()("div",{style:{fontSize:14,padding:e.isMobile?"12px 16px":"0 14px 3px 14px",color:this.theme.lightTextColor,wordBreak:"keep-all",...e.isMobile&&{background:this.theme.contentBackground,boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,marginBottom:1}}},void 0,o()(u.FormattedMessage,{defaultMessage:"Replicate page formats inside this database with templates.",id:"database.emptyTemplatesList.info"}))),a.length>6?p:void 0,c)}return c}renderInputHeader(){const{device:e}=this.environment,t=!e.isMobile||void 0;return o()("div",{style:{margin:e.isMobile?0:"10px 0"}},void 0,o()(N.ZP,{value:this.stores.templateInputStore.state.inputValue,focusInitial:t,placeholder:w.default.formatMessage(U.filterPlaceholder),showClearButton:!0,inputLeft:o()(N.f_,{icon:m.R}),onChange:this.handleTemplateFilterChange,style:{...e.isAndroid&&{borderBottom:"none"}}}))}renderTitle(){if(this.environment.device.isMobile)return;const e=this.props.collectionStore.getNameStore().getValue(),t=e?(0,x.Xh)(e,this.props.collectionStore):o()(u.FormattedMessage,{defaultMessage:"Untitled",id:"database.templateList.UntitledDatabaseTitle"});return o()(D.Z,{style:{marginTop:6},title:o()(R.Q,{prefix:o()(u.FormattedMessage,{id:"database.templatesList.templatesFor",defaultMessage:"Templates for"}),viewName:t}),right:o()(F.Z,{helpButtonContext:"collection_templates_menu",href:(0,Z.UY)("guides.databaseTemplates")})})}renderNewButtonMenuItem(e){const{isOverlay:t}=this.props,i=o()(u.FormattedMessage,{defaultMessage:"New template",id:"database.templateView.newTemplateButton"});return t?s.createElement(L.Z,r()({isBlue:this.environment.device.isDesktop,title:i},e)):s.createElement(H.Z,r()({title:i,icon:(0,p.R)({width:18,fill:this.theme.lightIconColor,marginLeft:1,marginRight:11}),type:"new_template",format:t?"collection-overlay":"page-menu-item",locked:this.props.locked},e))}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=_.default.state,i=t?(0,M.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:c.tY.Create}):(0,M.ZP)({store:e,fullyQualified:!1,pageVisitSource:c.tY.Create});this.navigate(i)}}Y.displayName="CollectionTemplatePicker",Y.contextTypes={...k.wK,...a.w,...C.xm};const z=Y},44514:(e,t,i)=>{i.d(t,{Q:()=>c});var n=i(23174),o=i.n(n),l=(i(67294),i(82990)),r=i(52821);const s={...l.Z.textOverflowStyle,position:"absolute",left:0,right:0,top:0,bottom:0},a={marginLeft:4,fontWeight:l.Z.fontWeight.semibold};function c(e){const{prefix:t,viewName:i,viewType:n}=e;return o()("div",{style:{position:"relative",width:"100%"}},void 0," ",o()("div",{style:s},void 0,t,n&&r.aW[n]({marginLeft:8,marginRight:2,width:"1em",display:"inline",verticalAlign:"bottom"}),o()("span",{style:a},void 0,i)))}},44862:(e,t,i)=>{i.d(t,{Z:()=>v});var n=i(23174),o=i.n(n),l=(i(67294),i(83355)),r=i(8848),s=i(60291),a=i(54497),c=i(5366),d=i(5149),p=i(41232),m=i(32363),h=i(16402),u=i(84076);class g extends l.Z{constructor(){super(...arguments),this.handleNavigateToSourceClick=()=>{const{collectionContextStore:e}=this.props;e&&(d.r$({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),d.H4({collectionSettingsStore:e.settingsStore,item:{type:"source"}}))}}renderComponent(){const{collectionStore:e}=this.props;if(e.isSyncedCollection())return this.renderSyncedCollectionIndicators()}renderSyncedCollectionIndicators(){const{collectionStore:e}=this.props,t=e.getFormatStore().getKeyStore("original_url").getValue(),i=e.getSpaceId(),n=Boolean(e.getFormatStore().getKeyStore("sync_state").getValue()),l=t&&(0,p.pI)(t,i);return o()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,l&&o()(u.Z,{href:l,style:{display:"inline-flex"},hoveredStyle:{background:"none",textDecoration:"underline"},innerStyle:{flexShrink:1,width:"none",padding:"2px 0px",marginRight:5,borderRadius:3,display:"flex",alignItems:"center",alignSelf:"center",...this.getStyle()},external:!0},void 0,(0,m.wY)(t,i)),n?o()("span",{style:{color:this.theme.mediumTextColor}},void 0,"•"):null,n?this.renderSyncState():null)}renderSyncState(){var e,t;const{collectionStore:i}=this.props,n=i.getFormatStore().getKeyStore("sync_state").getKeyStore("syncing").getValue(),l=i.getFormatStore().getKeyStore("sync_state").getKeyStore("last_synced_at").getValue(),d=null===(e=this.props.collectionContextStore)||void 0===e?void 0:e.numberChildrenUnfurled.state,p=null===(t=this.props.collectionContextStore)||void 0===t?void 0:t.numberChildrenReceived.state,m=d&&p&&d/p<1&&!this.environment.device.isMobile,g=n&&this.environment.device.isMobile;let v;return l&&(v=o()(c.FormattedMessage,{defaultMessage:"Synced {lastSyncedAt}",id:"synced.lastSyncedAt.label",values:{lastSyncedAt:(0,h.IS)(l,{useLowercase:!0})}})),"row_limit_exceeded"===n?o()(u.Z,{style:{display:"inline-flex",...this.getStyle()},onClick:this.handleNavigateToSourceClick},void 0,o()("span",{style:{marginLeft:5,marginRight:5,display:"inline-flex",...this.getStyle()}},void 0,(0,a.t)({fill:(0,r.fi)("orange",this.theme).fill,marginLeft:4,marginRight:4,width:12,alignSelf:"center"}),o()(c.FormattedMessage,{defaultMessage:"Partial Sync",id:"synced.partial_sync.label"}))):m||g?o()("span",{style:{marginLeft:5,marginRight:5,display:"inline-flex",...this.getStyle()}},void 0,o()(c.FormattedMessage,{defaultMessage:"Syncing",id:"synced.syncing.label"}),(0,s.b)({marginLeft:4,marginRight:4,width:12,alignSelf:"center"},"sync-spinner")):o()("span",{style:{marginLeft:5,marginRight:5,display:"inline-flex",...this.getStyle()}},void 0,v)}getStyle(){return{color:this.theme.mediumTextColor,fontSize:14,lineHeight:1.2}}}g.displayName="SyncedCollectionIndicators";const v=(0,c.injectIntl)(g)},65669:(e,t,i)=>{function n(e){let t,i,n;return async function(){for(var o=arguments.length,l=new Array(o),r=0;r<o;r++)l[r]=arguments[r];return t?(n=l,i||(i=t.then((()=>(i=void 0,t=e(...n),t))),i)):(t=e(...l),t)}}i.d(t,{Z:()=>n})}}]);