"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7686],{3992:(e,t,o)=>{o.r(t),o.d(t,{addRecurrence:()=>h,createRecurrenceInner:()=>v,disableRecurrence:()=>g});var n=o(40506),i=o(4615),r=o(98963),s=o(18844),a=o(6287),l=o(80444),c=o(57559),d=o(50906),p=o(96802),u=o(9953),m=o(39699);function h(e){let{environment:t,blockStore:o,recurrence:l}=e;const p=o.getAutomationId(),h=function(e){return{...e,start_date:(0,n.Io)(new Date(e.start_date))}}(l);p?function(e,t,o,n){const l=o.getParentStore();if(!l||l.table!==a.v)return;const p=o.getSpaceId(),h={table:r.cv,id:t,spaceId:p},g=c.Mz.createChildStore(o,h),v=g.getTrigger();if(!v)return;const M=g.getActionStores()[0];m.createAndCommit({environment:e,userAction:"recurrenceActions.updateRecurrence",perform:t=>{const r=f({automationId:g.id,spaceId:p,collectionPointer:l.getSpaceShardedPointer(),templatePageId:o.id});let a;M?(a=M.id,u.sW({store:M,data:r,transaction:t})):(a=(0,i.ZP)(),u.ae({environment:e,table:s.Xj,inMemoryRecordCache:g.inMemoryRecordCache,transaction:t,value:{id:a,...r}})),u.sW({store:g,data:{status:"active",trigger:{id:v.id,type:"recurrence",recurrence:n},action_ids:[a]},transaction:t})}}),d.h$X(e,{type:"updated",frequency:n.frequency})}(t,p,o,h):function(e,t,o){m.createAndCommit({environment:e,userAction:"recurrenceActions.createRecurrence",perform:n=>{v(n,e,t,o)}})}(t,o,h)}function g(e){let{environment:t,blockStore:o}=e;const n=o.getAutomationId();if(!n)return;const i={table:r.cv,id:n,spaceId:o.getSpaceId()};m.createAndCommit({environment:t,userAction:"recurrenceActions.disableRecurrence",perform:e=>{u.sW({store:(0,c.Kv)(o,i),data:{status:"disabled",run_at:void 0},transaction:e})}}),d.h$X(t,{type:"disabled"})}function v(e,t,o,n){const{currentUserRootStore:c}=l.default.state;if(!c)return;const m=o.getParentStore();if(!m||m.table!==a.v)return;if(!m.getParentBlockStore())return;const h=o.getSpaceId(),g=(0,i.ZP)(),v=(0,i.ZP)();u.ae({environment:t,table:r.cv,inMemoryRecordCache:o.inMemoryRecordCache,value:{id:g,parent_id:o.id,parent_table:o.table,alive:!0,space_id:h,status:"active",trigger:{id:(0,i.ZP)(),type:"recurrence",recurrence:n},action_ids:[v]},transaction:e}),p.FH({stores:[o],update:{automation_id:g},transaction:e}),u.ae({environment:t,table:s.Xj,inMemoryRecordCache:o.inMemoryRecordCache,transaction:e,value:{id:v,...f({automationId:g,spaceId:h,collectionPointer:m.getSpaceShardedPointer(),templatePageId:o.id})}}),d.h$X(t,{type:"created",frequency:n.frequency})}function f(e){const{automationId:t,spaceId:o,collectionPointer:n,templatePageId:i}=e;return{parent_id:t,parent_table:r.cv,type:"create_page",alive:!0,space_id:o,config:{collection:n,template_page_id:i}}}},40071:(e,t,o)=>{o.d(t,{Z:()=>te});var n=o(23174),i=o.n(n),r=o(10434),s=o.n(r),a=o(94184),l=o.n(a),c=o(67294),d=o(83355),p=o(15145),u=o(88437),m=o(39132),h=o(18557),g=o(53470),v=o(37612),f=o(72126),M=o(5366),y=o(50906),S=o(98834),C=o(47307),b=o(96802),k=o(3992),P=o(75018),I=o(39699),A=o(66890),T=o(66213),E=o(19037),Z=o(43250),w=o(84210),D=o(33929),_=o(87279),R=o(98742),x=o(77907),L=o(17031),F=o(80444),B=o(61766),N=o(96049),O=o(31792),z=o(57559),H=o(24736),V=o(45669),W=o(93405),Y=o(31945),j=o(78140),U=o(32163),X=o(53437),q=o(31278),$=o(76798),G=o(72495),J=o(26388),K=o(34574);const Q=(0,M.defineMessages)({emptyPageTitle:{defaultMessage:"Empty",id:"database.templatePicker.emptyPageTitle"}});class ee extends d.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:O.Z,buttonPopupStore:B.Z},this.renderActionMenuPopup=e=>{const{device:t}=this.environment,o=!!this.props.templateStore&&(0,E.J5)({environment:this.environment,blocks:[this.props.templateStore],publicEditMode:void 0}),n={key:"section",render:e=>c.createElement(G.Z,e),items:f.oA([this.props.templateStore&&!this.canEditContentOnly.state&&o&&{key:"repeatControl",render:(e,t)=>this.props.templateStore&&c.createElement(x.LazyRecurrenceConfigMenu,s()({},e,{templateStore:this.props.templateStore,parent:t})),action:this.handleRecurrence},this.props.isOverlay&&!this.canEditContentOnly.state&&{key:"Set default",render:e=>c.createElement(W.Z,s()({},e,{title:i()(M.FormattedMessage,{defaultMessage:"Set as default",id:"database.collectionTemplatePickerItem.actionMenu.setAsDefault"}),svg:h.z})),action:()=>this.handleSetAsDefault(e)},this.props.templateStore&&{key:"Edit",render:e=>c.createElement(W.Z,s()({},e,{title:i()(M.FormattedMessage,o?{defaultMessage:"Edit",id:"database.templatePickerItem.actionMenu.edit"}:{defaultMessage:"View",id:"database.templatePickerItem.actionMenu.view"}),svg:o?g.H:m.c})),action:this.handleEdit},this.props.templateStore&&!this.canEditContentOnly.state&&o&&{key:"Duplicate",render:e=>c.createElement(W.Z,s()({},e,{title:i()(M.FormattedMessage,{defaultMessage:"Duplicate",id:"database.templatePickerItem.actionMenu.duplicate"}),svg:u.a})),action:this.handleDuplicate},this.props.templateStore&&!this.canEditContentOnly.state&&o&&{key:"Delete",render:e=>c.createElement(W.Z,s()({},e,{title:i()(M.FormattedMessage,{defaultMessage:"Delete",id:"database.templatePickerItem.actionMenu.delete"}),svg:v.y})),action:o?this.handleDelete:()=>{}}])};let r;return r=t.isMobile?{menuType:_.og.ActionSheet}:{menuType:_.og.Popup,width:230},c.createElement(j.Z,r,i()(U.Z,{type:U.i.Vertical,initialFocus:void 0,sections:[n]}))},this.handleRecurrence=()=>{y.efr(this.environment,{isConfigured:void 0!==this.props.recurrence})},this.handleEdit=()=>{var e,t;const{buttonPopupStore:o}=this.stores;this.props.templateStore&&(null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t),this.navigateToBlock(this.props.templateStore),o.reset(),y.sYL(this.environment,{template_action:"edit"}))},this.handleDuplicate=()=>{var e,t;const{buttonPopupStore:o}=this.stores,{templateStore:n,collectionStore:i}=this.props;if(!n)return;null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t);const{performResult:r}=I.createAndCommit({userAction:"CollectionTemplatePickerItem.duplicatedStore",environment:this.environment,perform:e=>{const t=S.Zh({environment:this.environment,collectionStore:i,templateStore:n,transaction:e});if(n.getAutomationId()){const o=z.Mz.fromBlockStore(n),i=null==o?void 0:o.getRecurrence();o&&null!=o&&o.isActive()&&i&&k.createRecurrenceInner(e,this.environment,t,i)}return t}});r&&this.navigateToBlock(r),o.reset(),y.sYL(this.environment,{template_action:"duplicate"})},this.handleDelete=async()=>{const{templateStore:e,collectionStore:t}=this.props;if(!e)return;await C.confirmUserAction({message:i()(M.FormattedMessage,{defaultMessage:"Are you sure you would like to delete this template?",id:"database.confirmDialog.templatePickerItem.deleteMessage"}),acceptLabel:i()(M.FormattedMessage,{defaultMessage:"Delete",id:"database.confirmDialog.templatePickerItem.deleteButton.label"})})&&(I.createAndCommit({userAction:"CollectionTemplatePickerItem.handleDelete",environment:this.environment,perform:o=>S.R5({collectionStore:t,templateStore:e,transaction:o})}),y.sYL(this.environment,{template_action:"delete"}))},this.handleSetAsDefault=e=>{var t,o;const{collectionContextStore:n}=this.context,r=null==n?void 0:n.collectionStore(),s=null==n?void 0:n.collectionViewStore();if(!r||null==s||!s.isDefined())return;const a=null!==(t=this.props.templateStore)&&void 0!==t&&t.id?{template_page_id:null===(o=this.props.templateStore)||void 0===o?void 0:o.id}:"empty";C.showDialog({showCancel:!0,keepFocus:!1,message:i()(M.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.message",defaultMessage:"<span>Use “{pageName}” as default template when creating new pages?</span>",values:{span:e=>i()("span",{},void 0,e),pageName:this.props.templateStore?i()($.Z,{store:this.props.templateStore,style:{display:"inline"}}):D.default.formatMessage(Q.emptyPageTitle)}}),items:[{label:i()(M.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.setCollection",defaultMessage:"For all views in “{databaseName}”",values:{databaseName:i()($.Z,{store:r,style:{display:"inline"}})}}),onAccept:()=>{e.close(),I.createAndCommit({environment:this.environment,userAction:"CollectionTemplatePickerItem.handleSetAsDefault:collection",perform:e=>{b.FH({stores:[r],update:{collection_default_template:a},transaction:e}),b.FH({stores:[s],update:{collection_view_default_template:a},transaction:e})}})}},{label:i()(M.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.setCollectionView",defaultMessage:"Only on “{viewName}” view",values:{viewName:i()(V.Z,{collectionViewName:s.getName(),collectionViewType:s.getType()})}}),onAccept:()=>{e.close(),I.createAndCommit({environment:this.environment,userAction:"CollectionTemplatePickerItem.handleSetAsDefault:collectionView",perform:e=>{b.FH({stores:[s],update:{collection_view_default_template:a},transaction:e})}})}}]})},this.handleMouseMove=()=>{N.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.getRecordModel=this.props.collectionStore.getRecordModel,this.canEditContentOnly=this.createComputedStore((()=>{var e;return Boolean(null===(e=this.props.collectionStore.getParentBlockStore())||void 0===e?void 0:e.canEditContentOnly())}))}get registries(){return[L.Z]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):P.navigate({environment:this.environment,url:e})}renderComponent(){var e;const{device:t}=this.environment,{templateStore:o,isMobile:n,isOverlay:r,focused:s,locked:a,canConfigureCollection:l,draggable:c}=this.props,{mouseStore:d,buttonPopupStore:p}=this.stores,u=!o&&!r,m=(!a||a&&!c)&&(l||this.canEditContentOnly.state)&&(d.state.mouseEntered||p.state.open||n||r)&&!u,h=o?i()($.Z,{store:o}):D.default.formatMessage(Q.emptyPageTitle),g=null==o||null===(e=o.getModel())||void 0===e?void 0:e.getRenderIcon({getRecordModel:this.getRecordModel});return i()(K.Z,{className:Z.$ji,type:o?"custom_template":"empty_page",format:r?"collection-overlay":"page-menu-item",locked:a||!l||!c,icon:i()(q.Z,{disabled:!0,icon:g,isEmptyPage:(null==o?void 0:o.isEmptyPage())??!0,size:t.isMobile&&r?24:20,isLarge:!r,style:{...!r&&{pointerEvents:"none",marginRight:10}},pageIconStyle:{...!r&&{fill:this.theme.lightIconColor}}}),title:h,onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,right:m&&this.renderActionMenuButton(),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,focused:s,isDefault:this.props.isDefault,recurrence:this.props.recurrence})}renderActionMenuButton(){const{isMobile:e,isOverlay:t}=this.props,{buttonPopupStore:o}=this.stores,n=!!this.props.templateStore&&(0,E.J5)({environment:this.environment,blocks:[this.props.templateStore],publicEditMode:void 0});return i()(J.Z,{renderTooltip:()=>i()(M.FormattedMessage,n?{defaultMessage:"Edit this template",id:"database.templatePickerItem.editTemplate.tooltip"}:{defaultMessage:"View this template",id:"database.templatePickerItem.viewTemplate.tooltip"}),delayThreshold:300,render:n=>i()(Y.ZP,{popupType:e?X.ZP.PopupType.SlideUp:X.ZP.PopupType.Popup,placementToOrigin:Y.pO.Right,originGap:12,buttonPopupStore:o,renderOrigin:o=>c.createElement(H.Z,s()({className:l()(Z.C_N,{[Z.JiD]:e||t}),isMobile:e&&t,style:{...!t&&{marginRight:0}}},(0,R.Z)(n,o))),render:this.renderActionMenuPopup,onClick:()=>{y.sYL(this.environment,{template_action:"open_menu"})}})})}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=F.default.state,o=t?(0,w.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:p.tY.PeekOpen}):(0,w.ZP)({store:e,fullyQualified:!1,pageVisitSource:p.tY.LinkInPage});this.navigate(o)}}ee.displayName="CollectionTemplatePickerItem",ee.contextTypes={...d.w,...T.wK,...A.xm};const te=ee},34574:(e,t,o)=>{o.d(t,{Z:()=>g});var n=o(23174),i=o.n(n),r=(o(67294),o(83355)),s=o(49271),a=o(8848),l=o(53523),c=o(82990),d=o(5366),p=o(12921),u=o(64921),m=o(52275);class h extends r.Z{constructor(){super(...arguments),this.completionsEnabledStore=this.createComputedStore((()=>{var e;const t=null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state;return(0,p.GD)(this.environment,t)}))}renderComponent(){return"collection-overlay"===this.props.format?this.renderCollectionOverlayMenuItem():"phone-modal"===this.props.format?this.renderPhoneModalMenuItem():this.renderPageMenuItem()}renderCollectionOverlayMenuItem(){const{device:e}=this.environment;return i()(m.Z,{className:this.props.className,icon:this.props.icon,title:this.renderTitle(),right:this.props.right,focused:this.props.focused,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,showDragHandle:!e.isMobile&&!this.props.locked,dragHandleDisabled:"empty_page"===this.props.type})}renderPhoneModalMenuItem(){return i()(m.Z,{icon:this.props.icon,title:this.renderTitle(),focused:this.props.focused,onClick:this.props.onClick,showDragHandle:!1})}renderPageMenuItem(){return i()(u.Z,{style:this.getWrapStyle(),hovered:this.props.focused,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,hoveredStyle:{background:this.theme.buttonHoveredBackground,color:this.theme.regularTextColor},pressedStyle:{background:this.theme.buttonPressedBackground}},void 0,i()("div",{style:this.getIconWrapStyle()},void 0,this.props.icon),this.renderTitle(),this.props.right&&i()("div",{style:{marginLeft:"auto",marginRight:4}},void 0,this.props.right))}renderTitle(){return"collection-overlay"!==this.props.format?this.props.title:i()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},void 0,this.props.title,i()("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},void 0,this.props.isDefault&&i()("span",{style:{fontSize:12,fontWeight:c.Z.fontWeight.medium,color:this.theme.mediumTextColor}},void 0,i()(d.FormattedMessage,{defaultMessage:"DEFAULT",id:"database.templatePickerMenuItem.default"})),this.props.recurrence&&(0,l.N)({width:14,color:a.ZP.blue,marginLeft:8})))}getWrapStyle(){const{device:e}=this.environment;return{...s.ZD,display:"flex",alignItems:"center",flexGrow:1,height:e.isMobile?36:32,fontSize:16,borderRadius:4,paddingLeft:8,marginBottom:2,color:this.completionsEnabledStore.state?this.theme.mediumTextColor:this.theme.lightTextColor}}getIconWrapStyle(){return{display:"flex",alignItems:"center",width:24,height:24,marginRight:10}}}h.displayName="TemplatePickerMenuItem";const g=h},39132:(e,t,o)=>{o.d(t,{c:()=>r});var n=o(23174),i=o.n(n);o(67294);const r=(0,o(45238).I)("eye",{viewBox:"0 0 32 32",svg:i()("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})},53523:(e,t,o)=>{o.d(t,{N:()=>r});var n=o(23174),i=o.n(n);o(67294);const r=(0,o(45238).I)("repeat",{viewBox:"0 0 16 14",svg:i()("path",{d:"M1.185 7.317a.689.689 0 00.697-.704v-.601c0-1.19.806-1.942 2.064-1.942H9.23v1.573c0 .328.199.52.527.52a.66.66 0 00.403-.144l2.68-2.236c.253-.212.26-.547 0-.765L10.16.782A.62.62 0 009.757.64c-.328 0-.527.184-.527.52v1.53H4.05C1.875 2.69.48 3.9.48 5.875v.738c0 .397.308.704.705.704zm13.624-.649a.689.689 0 00-.698.704v.608c0 1.19-.806 1.942-2.064 1.942H6.763V8.35c0-.329-.199-.52-.527-.52a.66.66 0 00-.403.144l-2.68 2.242c-.26.212-.26.547 0 .759l2.68 2.242a.66.66 0 00.403.143c.328 0 .527-.191.527-.52v-1.544h5.181c2.174 0 3.569-1.21 3.569-3.179v-.745a.695.695 0 00-.704-.704z"})})}}]);