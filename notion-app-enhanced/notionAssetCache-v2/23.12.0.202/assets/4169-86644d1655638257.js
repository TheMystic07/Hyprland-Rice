"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4169],{87636:(e,t,o)=>{o.d(t,{Z:()=>v});var i=o(23174),s=o.n(i),n=o(67294),r=o(83355),a=o(13991),l=o(22491),d=o(97880),h=o(82990),g=o(17311),p=o(23063),c=o(64921),m=o(26388);class u extends r.Z{renderComponent(){const{children:e,isVisible:t,position:o,style:i}=this.props,r=n.Children.toArray(e).filter(d.$K),a=r.length;return s()(p.Z,{isVisible:!0,animationStyle:{opacity:t?1:0},render:()=>n.createElement("div",(0,l.iv)(this.getContainerStyle(),i,t&&this.getHoveredContainerStyle(),"top"===o&&this.getTopContainerStyle()),r.map(((e,t)=>this.renderChild(e,t===a-1))))})}renderButton(e,t){return n.cloneElement(e,{...(0,l.iv)(e.props.style,this.getButtonStyle(),t&&this.getButtonLastStyle()),hoveredStyle:(0,l.iv)(this.getButtonHoveredStyle(),t&&this.getButtonLastStyle()).style,pressedStyle:this.getButtonPressedStyle()})}renderChild(e,t){if(e&&"object"==typeof e&&"type"in e){if(e.type===m.Z&&n.isValidElement(e))return n.cloneElement(e,{render:(o,i)=>{const s=e.props.render(o,i);return this.renderButton(s,t)}});if(e.type===c.Z&&n.isValidElement(e))return this.renderButton(e,t)}}getContainerStyle(){return{color:this.theme.actionMenuButtonTextColor,fill:this.theme.actionMenuButtonTextColor,fontSize:12,background:this.theme.whiteButtonBackground,boxShadow:this.theme.lightBoxShadow,display:"flex",whiteSpace:"nowrap",borderRadius:g.Z.borderRadius,maxWidth:"calc(100% - 16px)",minHeight:24,overflow:"hidden",pointerEvents:this.environment.device.isMobile?"auto":"none",opacity:this.environment.device.isMobile?1:0,fontFamily:h.Z.getCompositeFontFamily(a.SP).sans,position:"absolute",right:g.Z.horizontal.small,bottom:g.Z.vertical.small,zIndex:2}}getHoveredContainerStyle(){return{pointerEvents:"auto",opacity:1}}getTopContainerStyle(){return{top:g.Z.vertical.small,bottom:void 0}}getButtonLastStyle(){return{borderRight:"none"}}getButtonStyle(){return{display:"flex",alignItems:"center",padding:"4px 6px",fontWeight:h.Z.fontWeight.medium,borderRight:`1px solid ${this.theme.regularDividerColor}`,color:this.theme.actionMenuButtonTextColor,fill:this.theme.actionMenuButtonTextColor}}getButtonHoveredStyle(){return{background:this.theme.whiteButtonHoveredBackground}}getButtonPressedStyle(){return{background:this.theme.whiteButtonPressedBackground}}}u.displayName="ActionMenuGroup";const v=u},74169:(e,t,o)=>{o.d(t,{Z:()=>E});var i=o(23174),s=o.n(i),n=o(67294),r=o(83355),a=o(72126),l=o(5366),d=o(47307),h=o(96802),g=o(27153),p=o(39699),c=o(53471),m=o(33929),u=o(49085);const v="loadingLocalImage",S="uploading",C="loaded";class y extends u.default{getInitialState(){return{loadingMode:C}}}const M=y;var f=o(31792),R=o(87636),w=o(23063),P=o(64921),b=o(12981),D=o(65107),Z=o(68785),x=o(32854),I=o(81865),k=o(50919),B=o(56282);const U=(0,l.defineMessages)({embedPlaceholder:{defaultMessage:"Paste an image linkâ€¦",id:"pageCover.embedType.placeholder"}});class F extends r.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={imageUploadStore:M,mouseStore:f.Z},this.handleLoadComplete=()=>{this.stores.imageUploadStore.reset()},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:i,handleRepositionClick:n,handleSavePositionClick:r}=e;if(this.props.disabled||this.stores.imageUploadStore.state.loadingMode!==C)return;const{device:a}=this.environment,{isMobile:d}=a;return s()(w.Z,{isVisible:!0,animationStyle:{width:this.getAdjustedPageWidth(),opacity:t?1:0},render:()=>s()("div",{style:{position:"relative",pointerEvents:t?"auto":"none",maxWidth:"100%"}},void 0,s()(R.Z,{isVisible:t,position:"bottom",style:{marginRight:this.props.paddingRight,marginLeft:this.props.paddingLeft}},void 0,!o&&s()(P.Z,{style:{...k.Z.actionButtonStyle,...d&&{borderRight:"none"}},onClick:this.handleChangeCoverClick},void 0,s()(l.FormattedMessage,{defaultMessage:"Change cover",id:"pageCover.changeCover.text"})),!o&&!d&&s()(P.Z,{style:{...k.Z.actionButtonStyle,borderRight:"none"},onClick:e=>n(e,this.lastProxiedUrl)},void 0,s()(l.FormattedMessage,{defaultMessage:"Reposition",id:"pageCover.reposition.text"})),o&&!d&&s()(P.Z,{style:k.Z.actionButtonStyle,onClick:r},void 0,s()(l.FormattedMessage,{defaultMessage:"Save position",id:"pageCover.savePosition.text"})),o&&!d&&s()(P.Z,{style:{...k.Z.actionButtonStyle,borderRight:"none"},onClick:i},void 0,s()(l.FormattedMessage,{defaultMessage:"Cancel",id:"pageCover.reposition.cancelText"}))))})},this.handleFlushTemporaryPosition=e=>{let{imagePosition:t,reset:o}=e;p.createAndCommit({userAction:"PageCover.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{h.Mp({store:this.props.store,coverPosition:t,transaction:e}),o()}})},this.handleChangeCoverClick=e=>{const{intl:t,store:o}=this.props;this.stores.mouseStore.reset();const i=e.target.getBoundingClientRect();g.$(this.environment,{originGap:3,originRect:i,isSmallWidth:!1,popupWidth:540,maxHeight:485,title:t.formatMessage({defaultMessage:"Page cover",id:"pageCover.mobileMenu.title"}),onDelete:this.handleDelete,currentTab:"gallery",tabs:[{type:"gallery",onChange:this.handleGalleryChange},{type:"file",fileUpload:!1,imageUpload:!0,videoUpload:!1,caption:s()(l.FormattedMessage,{defaultMessage:"Images wider than {idealImageWidth} pixels work best.",id:"pageCover.fileType.caption",values:{idealImageWidth:1500}}),onUpload:e=>{this.props.store.getCoverStore()&&c.cT({environment:this.environment,file:e,bucket:"secure",record:o.pointer,onStart:this.handleUploadStart,onProgress:this.handleUploadProgress,onComplete:this.handleUploadComplete,onError:()=>{d.showErrorMessage(t.formatMessage({defaultMessage:"Upload failed",id:"pageCover.errorDialogMessage.uploadFailed"}))}})}},{type:"embed",title:s()(l.FormattedMessage,{defaultMessage:"Link",id:"pageCover.embedType.title"}),inputPlaceholder:m.default.formatMessage(U.embedPlaceholder),caption:s()(l.FormattedMessage,{defaultMessage:"Works with any image from the web.",id:"pageCover.embedType.caption"}),buttonText:s()(l.FormattedMessage,{defaultMessage:"Submit",id:"pageCover.embedType.buttonText"}),onChange:this.handleEmbedLinkChange},{type:"unsplash",onChange:this.handleGalleryChange}]})},this.handleUploadComplete=e=>{this.updatePageCover({url:e,position:.5})},this.handleGalleryChange=e=>{const{url:t,position:o}=e;this.updatePageCover({url:t,position:a.hj(o)?o:.5});const{device:i}=this.environment;i.isMobile&&g.Z()},this.handleEmbedLinkChange=e=>{this.updatePageCover({url:e,position:.5}),g.Z()},this.coverWithRecordStore=this.createComputedStore((()=>this.props.store.getCover()),!0),this.updatePageCover=async e=>{const{url:t,position:o}=e,{serverCommitResult:i}=p.createAndCommit({userAction:"PageCover.updatePageCover",environment:this.environment,perform:e=>{h.fs({store:this.props.store,url:t,position:o,transaction:e})}});await i,this.stores.imageUploadStore.state.loadingMode===S&&this.stores.imageUploadStore.setState({loadingMode:"downloading",dataURL:this.stores.imageUploadStore.state.dataURL,uploadProgress:100})},this.handleUploadStart=e=>{const{file:t,name:o,size:i}=e;if(g.Z(),this.stores.imageUploadStore.setState({loadingMode:v,file:t,name:o,size:i}),t.type.indexOf("image")>=0){const e=new FileReader;e.onload=e=>{this.stores.imageUploadStore.state.loadingMode===v&&this.stores.imageUploadStore.setState({...this.stores.imageUploadStore.state,uploadProgress:0,loadingMode:S,dataURL:e.target.result})},e.readAsDataURL(t)}},this.handleUploadProgress=e=>{const{progressPercent:t}=e;this.stores.imageUploadStore.state.loadingMode===S&&this.stores.imageUploadStore.setState({...this.stores.imageUploadStore.state,uploadProgress:t})},this.handleDelete=()=>{g.Z(),p.createAndCommit({userAction:"PageCover.handleDelete",environment:this.environment,perform:e=>{h.MF({store:this.props.store,transaction:e})}})}}renderComponent(){const e=this.coverWithRecordStore.getState();if(!e)return;const t=this.stores.imageUploadStore.state,o=t.loadingMode!==C&&t.loadingMode!==v;return s()(B.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:this.handleFlushTemporaryPosition,renderControl:this.renderControl,source:"page",store:this.props.store,style:{display:"flex",flexDirection:"column",alignItems:"center",height:this.props.height,cursor:"default"},render:i=>s()(n.Fragment,{},void 0,s()(I.Z,{url:e.cover,isAuthenticated:!0,permissionRecord:e.pointer,width:this.props.proxyWidth,render:(e,n)=>{this.lastProxiedUrl=n;const r={width:"100%",height:this.props.height,objectFit:"cover",opacity:o?.5:1,objectPosition:`center ${100*(1-(i.imagePosition||0))}%`,borderRadius:0},a={width:"100%",height:this.props.height};return s()(D.B,{src:n,placeholderSrc:o?t.dataURL:void 0,placeholderBehavior:o?"force-show-placeholder":"show-placeholder-if-loading-src",containerStyle:a,imageStyle:r,onLoadComplete:this.handleLoadComplete})}}),o&&s()("div",{style:b.Z.loadingContainerStyle},void 0,s()(Z.Z,{style:{width:16,height:16,marginRight:4}}),s()("div",{style:{minWidth:30,textAlign:"right"}},void 0,s()(x.Z,{percentage:t.uploadProgress}))))})}getAdjustedPageWidth(){let e;return e=!!this.props.store.isFullWidth()?"100%":900,e}}F.displayName="PageCover";const E=(0,l.injectIntl)(F)},56282:(e,t,o)=>{o.d(t,{Z:()=>x});var i=o(23174),s=o.n(i),n=o(10434),r=o.n(n),a=o(67294),l=o(73935),d=o(83355),h=o(13991),g=o(6740),p=o(49085),c=o(12137),m=o(8848),u=o(22491),v=o(72126),S=o(82990),C=o(63143),y=o(5366),M=o(24677),f=o(31792),R=o(27724);class w extends p.default{getInitialState(){return{showFadeInAnimation:!1,isRepositioning:!1}}}const P=w;var b=o(23063),D=o(6685);class Z extends d.Z{constructor(){super(...arguments),this.storeTypes={focusStore:p.default.createClass(!1),mouseStore:f.Z,withImageRepositioningStore:P},this.renderDraggable=()=>s()(D.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disabled:!this.isRepositioning(),render:e=>a.createElement("div",r()({},(0,u.iv)(this.getDragContainerStyle()),e),this.props.render({imagePosition:this.getRenderedCoverPosition(),isRepositioning:this.isRepositioning(),showFadeInAnimation:!1}))}),this.shouldBeActiveStore=this.createComputedStore((()=>0===R.default.state.stores.length)),this.handleFocus=e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,g.E)(t)&&this.stores.focusStore.setState(!0)},this.handleBlur=e=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=e=>{this.mouseStore.setState({...this.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=e=>{this.mouseStore.setState({...this.mouseStore.state,mouseEntered:!1})},this.handleMouseMoveThrottled=(0,v.P2)(this.handleMouseMove,100),this.handleMouseLeaveDebounced=(0,v.Ds)(this.handleMouseLeave,100),this.handleWindowMouseDown=e=>{const t=l.findDOMNode(this);t&&!t.contains(e.target)&&this.isRepositioning()&&this.props.onFlushTemporaryPosition({imagePosition:this.getRenderedCoverPosition(),reset:()=>{this.mouseStore.reset(),this.stores.withImageRepositioningStore.reset()}})},this.handleRepositionClick=(e,t)=>{M.ZH(this.environment);const o=new Image;o.onload=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,isRepositioning:!0,image:o})},t&&(o.src=t)},this.handleCancelClick=e=>{this.stores.withImageRepositioningStore.reset()},this.handleSavePositionClick=e=>{this.props.onFlushTemporaryPosition({imagePosition:this.getRenderedCoverPosition(),reset:()=>{this.stores.withImageRepositioningStore.reset()}})},this.handleDragStart=e=>{const t=this.isRepositioning(),{image:o}=this.stores.withImageRepositioningStore.state;if(o&&t){const e=l.findDOMNode(this);if(e&&e instanceof Element){const t=e.getBoundingClientRect().width/o.width*o.height,i=this.getRenderedCoverPosition();this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:t,startDragRenderedPosition:i})}}},this.handleDragMove=e=>{if(this.isRepositioning()){const{startDragRenderedPosition:t,startDragImageScreenHeight:o}=this.stores.withImageRepositioningStore.state,i=e.diffY/(o||0)+(t||0);this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,temporaryPosition:(0,v.NM)((0,c.Z)(i,0,1),4)})}},this.handleDragEnd=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})},this.handleDragCancel=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})}}didMount(){super.didMount(),window.addEventListener("mousedown",this.handleWindowMouseDown)}willUnmount(){super.willUnmount(),window.removeEventListener("mousedown",this.handleWindowMouseDown)}willMountOrUpdate(){this.isRepositioning()&&!this.shouldBeActiveStore.state&&this.stores.withImageRepositioningStore.reset()}renderComponent(){const{device:e}=this.environment,{style:t}=this.props,{isMobile:o}=e,i=this.isRepositioning(),{mouseEntered:s}=this.mouseStore.state,n=this.stores.focusStore.state;return a.createElement("div",r()({onFocus:this.handleFocus,onBlur:this.handleBlur,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced},(0,u.iv)(this.getContainerStyle(),t)),this.renderDraggable(),this.renderDragMessage(),this.props.renderControl({handleRepositionClick:this.handleRepositionClick,handleSavePositionClick:this.handleSavePositionClick,handleCancelClick:this.handleCancelClick,isVisible:o||s||n||i,isRepositioning:i}))}renderDragMessage(){const{isRepositioning:e}=this.stores.withImageRepositioningStore.state;if(!this.props.small)return s()(b.Z,{isVisible:!0,animationStyle:{opacity:e?1:0},render:()=>a.createElement("div",r()({},(0,u.iv)(this.getDragMessageContainerStyle()),{"aria-hidden":!e}),s()(y.FormattedMessage,{defaultMessage:"Drag image to reposition",id:"withImageRepositioning.dragImage.text"}))})}isRepositioning(){return this.stores.withImageRepositioningStore.state.isRepositioning}getRenderedCoverPosition(){const{temporaryPosition:e}=this.stores.withImageRepositioningStore.state;return(0,v.hj)(e)?e:this.getPersistedCoverPosition()}getPersistedCoverPosition(){const{source:e,store:t}=this.props;if("gallery"===e||"board"===e){const e=t.getFormat().card_cover_position;if((0,v.hj)(e))return e}if(t.isCollectionView()){const e=t.getCollectionViewCollectionStore();if(e){const t=e.getFormat().collection_cover_position;if(!(0,C.z4)(t))return t}}else{const e=t.getFormat().page_cover_position;if((0,v.hj)(e))return e}return.5}get mouseStore(){return this.props.mouseStore||this.stores.mouseStore}getContainerStyle(){return{position:"relative",width:"100%"}}getDragContainerStyle(){return{width:"100%",cursor:this.isRepositioning()?"move":"inherit"}}getDragMessageContainerStyle(){return{background:m.ZP.blackWithAlpha(.4),borderRadius:3,color:m.ZP.white,fontSize:12,fontFamily:S.Z.getCompositeFontFamily(h.SP).sans,width:180,left:"calc(50% - 90px)",padding:"0.3em 1.5em 0.3em",pointerEvents:"none",position:"absolute",top:"calc(50% - 10px)",textAlign:"center"}}}Z.displayName="WithImageRepositioning";const x=Z}}]);