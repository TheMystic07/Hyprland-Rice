"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[6678],{38752:(e,t,n)=>{n.d(t,{S:()=>v,d:()=>k});var a=n(10434),o=n.n(a),r=n(23174),i=n.n(r),l=n(67294),c=n(480),s=n(24405),d=n(42853),u=n(54497),h=n(82990),m=n(24677),g=n(98104),p=n(89728),f=n(26388);const v=l.forwardRef(((e,t)=>{window.__c={n:"AutomationDropdownButton"};const{variant:n,onClick:a,style:r,icon:v,children:k,disabled:w}=e,y=(0,c.O7)(),C=(0,s.yK)((e=>({button:{..."gray"===n&&{color:e.mediumTextColor},..."blue"===n&&{color:e.blueColor,fontWeight:500},..."error"===n&&{color:e.errorText},maxWidth:"calc(100% + 2px)",marginLeft:1,padding:"0 8px 0 5px",...r},warningIcon:{width:12,height:12,marginLeft:-6,marginLeft:6,fill:e.errorText,color:e.errorText},chevronIcon:{width:10,height:10,marginLeft:4,marginTop:2,fill:e.lightIconColor},spacer:{flexGrow:1}})),[n,r]),S=(0,l.useCallback)((e=>{g.ZH(y),m.ZH(y),null==a||a(e)}),[a,y]);return i()(f.Z,{renderTooltip:()=>"error"===n?e.errorMessage:null,placement:f.Z.Placement.Bottom,disableTooltip:"error"!==n,delayThreshold:0,render:e=>l.createElement(p.Z,o()({},e,{style:C.button,icon:v,onClick:S,ref:t,shouldShrink:!0,disabled:w,disabledFeedback:w}),i()("div",{style:{...h.Z.textOverflowStyle}},void 0,k),i()("div",{style:C.spacer}),"error"===n&&(0,u.t)(C.warningIcon),(0,d.i)(C.chevronIcon))})}));function k(e){const{errorMessage:t,hasValue:n}=e;return(0,l.useMemo)((()=>t?{variant:"error",errorMessage:t}:n?{variant:"gray"}:{variant:"blue"}),[t,n])}},42876:(e,t,n)=>{n.d(t,{ZP:()=>R,N_:()=>O});var a=n(23174),o=n.n(a),r=n(10434),i=n.n(r),l=(n(57658),n(67294)),c=n(480),s=n(86628),d=n(24405),u=n(41892),h=n(77657),m=n(82114),g=n(36591),p=n(90199),f=n(35840),v=n(55159),k=n(72126),w=n(68626),y=n(97880),C=n(5366),S=n(54642),b=n(42631),x=n(33929),B=n(18441),I=n(80444),N=n(30874),Z=n(49085),F=n(92595);class L extends Z.default{getStateForBot(e){return this.state[e]??{channels:{},fetching:!1,lastRefreshed:0}}updateStateForBot(e,t){this.setState({...this.state,[e]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const n=this.getStateForBot(e);this.setState({...this.state,[e]:{...n,channels:{...n.channels,...t}}})}}const M=new L;(0,F.exposeDebugValue)("ExternalNotificationChannelsStore",M);const A=M;var E=n(52275),T=n(68894),V=n(68785),W=n(72495),_=n(33411);const P=(0,C.defineMessages)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…"}});function R(e){window.__c={n:"SlackSelectChannelView"};const{currentNotificationChannel:t,onNotificationChannelSelect:n,onClose:a,onNewSlackAccountAdded:r,renderMenu:m,channelFilter:p}=e,v=(0,c.O7)(),{isMobile:Z}=(0,c.Fy)(),F=(0,s.VK)((()=>N.Z.completeSlackAuthentications.state),[]),L=e.currentExternalAuthentication??k.Ps(F);l.useEffect((()=>{L&&async function(e){const{environment:t,botId:n,spaceId:a}=e,o=A.getStateForBot(n);if(o.fetching||Date.now()-o.lastRefreshed<15e3)return;let r;A.updateStateForBot(n,{fetching:!0,lastRefreshed:Date.now()});for(;;){const e=await S.getExternalNotificationChannels(t,{botId:n,spaceId:a,cursor:r});if("success"!==e.type){console.error(e.error);break}{const t={};for(const n of e.data.channels)t[n.id]=n;if(A.addChannelsForBot(n,t),r=e.data.cursor,!r)break}}A.updateStateForBot(n,{fetching:!1})}({environment:v,botId:L.id,spaceId:L.space_id})}),[v,L]);const[M,R]=l.useState(""),{loadedChannelsForAccount:z,isLoading:H}=(0,s.VK)((()=>{if(!L)return{loadedChannelsForAccount:[],isLoading:!1};const e=A.getStateForBot(L.id);return{loadedChannelsForAccount:Object.values(e.channels),isLoading:e.fetching}}),[L]),j=(0,s.VK)((()=>N.Z.integrations.state.find((e=>e.id===h.nO))),[]),q=(0,s.VK)((()=>{var e;return null===(e=I.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),D=l.useCallback((e=>{L&&n(e,L),a()}),[n,L,a]),U=(0,d.yK)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[]),J=l.useCallback((e=>{const{channel:n}=e;return{key:n.id,render:e=>l.createElement(E.Z,i()({},e,{icon:O({channel:n,styles:U.icon}),desktopIconStyle:{width:8},title:n.name,right:n.id===(null==t?void 0:t.id)&&(0,g.e)(U.icon)})),action:()=>{D(n)}}}),[D,U.icon,t]),{publicChannels:Q,privateChannels:$,personalChannels:G}=l.useMemo((()=>function(e,t){const n=[],a=[],o=[];for(const r of e)t&&!t(r)||("public"===r.type?n.push(r):"private"===r.type?a.push(r):"me"===r.type?o.push(r):(0,y.t1)(r.type));return{publicChannels:n,privateChannels:a,personalChannels:o}}(z,p)),[p,z]),Y=l.useCallback((()=>Q.map((e=>({menuListItem:J({channel:e}),channelName:e.name})))),[Q,J]),X=l.useCallback((()=>$.map((e=>({menuListItem:J({channel:e}),channelName:e.name})))),[$,J]),ee=l.useCallback((()=>G.map((e=>({menuListItem:J({channel:e}),channelName:e.name})))),[G,J]),te=l.useCallback((()=>Y().map((e=>{let{menuListItem:t,channelName:n}=e;if(K({channelName:n,query:M}))return t})).filter(y.$K)),[Y,M]),ne=l.useCallback((()=>X().map((e=>{let{menuListItem:t,channelName:n}=e;if(K({channelName:n,query:M}))return t})).filter(y.$K)),[X,M]),ae=l.useCallback((()=>ee().map((e=>{let{menuListItem:t,channelName:n}=e;if(K({channelName:n,query:M}))return t})).filter(y.$K)),[ee,M]),oe=l.useCallback((()=>{if(!L)return[];const e=[],t=te(),n=ne(),a=ae();return a.length>0&&e.push({key:"personal-channels",render:e=>l.createElement(W.Z,i()({},e,{title:(0,B.jg)(L).organizationName})),items:a}),t.length>0&&e.push({key:"public-channels",render:e=>l.createElement(W.Z,i()({},e,{topBorder:a.length>0,title:0===a.length&&(0,B.jg)(L).organizationName})),items:t}),n.length>0&&e.push({key:"private-channels",render:e=>l.createElement(W.Z,i()({},e,{topBorder:t.length>0,title:0===a.length&&t.length>0&&(0,B.jg)(L).organizationName})),items:n}),e}),[te,ne,ae,L]);if(!L||!j)return null;const re=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>o()("div",{},void 0,l.createElement(T.ZP,i()({},e,{inputLeft:o()(T.f_,{icon:f.R}),inputRight:o()(_.Z,{show:H,showDelay:500,showHold:300,render:e=>e&&o()(V.Z,{style:{marginRight:2}})}),showClearButton:!0,placeholder:x.default.formatMessage(P.channelSearchPlaceholder),focusInitial:!Z,value:M,onChange:e=>{R(e.target.value)}})))}],render:e=>l.createElement(W.Z,e)},...oe()];return t||re.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!q)return;const e=await b.hM({environment:v,integration:j,spaceId:q,from:"collection_view_settings"});w.x.isFail(e)||r()},render:e=>l.createElement(E.Z,i()({},e,{icon:o()("img",{src:u.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:o()(C.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})}))}],render:e=>l.createElement(W.Z,i()({},e,{topBorder:!0}))}),l.createElement(l.Fragment,null,m(re))}function K(e){const{channelName:t,query:n}=e;return 0===n.length||t.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0}function O(e){const{channel:t,styles:n}=e;return"private"===t.type?(0,p.b)(n):"me"===t.type?(0,m.p)(n):(0,v.J)(n)}},93364:(e,t,n)=>{n.d(t,{U:()=>I});var a=n(10434),o=n.n(a),r=n(23174),i=n.n(r),l=(n(30541),n(57658),n(67294)),c=n(480),s=n(86628),d=n(24405),u=n(41892),h=n(77657),m=n(5257),g=n(35840),p=n(5366),f=n(68626),v=n(42631),k=n(33929),w=n(18441),y=n(80444),C=n(30874),S=n(52275),b=n(68894),x=n(72495);const B=(0,p.defineMessages)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Search…"}});function I(e){window.__c={n:"SlackSelectWorkspaceView"};const{onWorkspaceSelect:t,renderMenu:n,workspaceFilter:a,onNewSlackAccountAdded:r}=e,I=(0,c.O7)(),{isMobile:N}=(0,c.Fy)(),Z=(0,s.VK)((()=>{var e;return null===(e=y.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),F=(0,s.VK)((()=>(0,w.P9)(C.Z.completeSlackAuthentications.state,a)),[a]),L=(0,s.VK)((()=>C.Z.integrations.state.find((e=>e.id===h.nO))),[]),[M,A]=l.useState(""),E=(0,d.yK)((e=>({chevronRight:{width:12,height:"auto",color:e.lightIconColor}})),[]);if(!L)return null;const T=Object.entries((0,w.YJ)(F,M)).map(((e,n)=>{let[a,r]=e;return{key:a,items:r.map((e=>{let{workspaceName:n,externalAuthentication:a}=e;return{key:a.id,action:()=>{t(a)},render:e=>l.createElement(S.Z,o()({},e,{title:n??i()(p.FormattedMessage,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace"}),right:(0,m.o)(E.chevronRight)}))}})),render:e=>l.createElement(x.Z,o()({},e,{title:a,topBorder:0!==n}))}}));return T.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>i()("div",{},void 0,l.createElement(b.ZP,o()({},e,{inputLeft:i()(b.f_,{icon:g.R}),showClearButton:!0,placeholder:k.default.formatMessage(B.workspaceSearchPlaceholder),focus:!N||void 0,value:M,onChange:e=>{A(e.target.value)}})))}],render:e=>l.createElement(x.Z,e)}),T.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!Z)return;const e=await v.hM({environment:I,integration:L,spaceId:Z,from:"collection_view_settings"});f.x.isFail(e)||e.value.externalAuthentication&&(t(e.value.externalAuthentication),null==r||r())},render:e=>l.createElement(S.Z,o()({},e,{icon:i()("img",{src:u.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:i()(p.FormattedMessage,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})}))}],render:e=>l.createElement(x.Z,o()({},e,{topBorder:!0}))}),l.createElement(l.Fragment,null,n(T))}},18441:(e,t,n)=>{n.d(t,{P9:()=>c,YJ:()=>s,jc:()=>l,jg:()=>i});n(57658);var a=n(77657),o=n(59753),r=n(32161);function i(e){if(e.integration_id!==a.nO)throw"Cannot render account for integration.";const t=/(.+) - (.+)/.exec(e.account_name);if(!t)return{accountName:e.account_name};const[,n,o]=t;return{organizationName:n,accountName:o}}function l(e){return o.kk.fromValue(r.P,e).getSlackWorkspaceId()}function c(e,t){return t?e.filter((e=>{const n=l(e);return!!n&&t(n)})):e}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n={};for(const a of e){const{accountName:e,organizationName:o}=i(a);d({query:t,accountName:e,organizationName:o})&&(n[e]||(n[e]=[]),n[e].push({externalAuthentication:a,workspaceName:o}))}return n}function d(e){const{accountName:t,organizationName:n,query:a}=e;if(0===a.length)return!0;const o=t.toLocaleLowerCase().indexOf(a.trim().toLocaleLowerCase())>=0,r=!!n&&n.toLocaleLowerCase().indexOf(a.trim().toLocaleLowerCase())>=0;return o||r}},24457:(e,t,n)=>{n.d(t,{F:()=>l,U:()=>i});var a=n(480),o=n(86628),r=n(87279);function i(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:r.og.ActionSheet}:{menuType:r.og.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function l(e){const t=(0,a.Fy)();return(0,o.VK)((()=>i({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},29502:(e,t,n)=>{n.d(t,{d:()=>i});var a=n(480),o=n(86628),r=n(53437);function i(e){const t=(0,a.Fy)();return(0,o.VK)((()=>t.isPhone||"slideUp"===(null==e?void 0:e.tabletBehavior)&&t.isTablet?r.kQ.SlideUp:r.kQ.Popup),[t,null==e?void 0:e.tabletBehavior])}},82114:(e,t,n)=>{n.d(t,{Q:()=>i,p:()=>l});var a=n(23174),o=n.n(a),r=(n(67294),n(45238));const i=o()("path",{d:"M.911 8.034c0 4.505 3.049 7.24 7.246 7.24 1.135 0 2.215-.158 2.885-.376.472-.15.622-.397.622-.65a.44.44 0 00-.451-.444 1.3 1.3 0 00-.321.048c-.834.205-1.552.341-2.516.341-3.74 0-6.29-2.255-6.29-6.118 0-3.698 2.407-6.275 6.03-6.275 3.206 0 5.886 1.975 5.886 5.523 0 2.072-.697 3.466-1.825 3.466-.752 0-1.176-.437-1.176-1.183V4.972c0-.37-.205-.595-.554-.595-.341 0-.553.226-.553.595v.779h-.062c-.349-.84-1.203-1.374-2.222-1.374-1.77 0-3.014 1.51-3.014 3.678 0 2.187 1.237 3.712 3.042 3.712 1.06 0 1.88-.575 2.276-1.545h.062c.13.963.943 1.551 2.023 1.551 1.907 0 3.09-1.873 3.09-4.498 0-3.971-2.92-6.548-6.96-6.548C3.886.727.912 3.632.912 8.034zm6.911 2.652c-1.223 0-2.003-1.018-2.003-2.638 0-1.593.786-2.611 2.01-2.611 1.258 0 2.05.998 2.05 2.584 0 1.62-.813 2.665-2.057 2.665z"}),l=(0,r.I)("at",{viewBox:"0 0 16 16",svg:i})}}]);