"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9729],{80671:(e,t,n)=>{n.d(t,{Cl:()=>d,Kj:()=>u,k2:()=>r,v5:()=>i});var o=n(4615),a=n(896),s=n(63423);function r(){s.Z.setState({open:!0,stage:"limit_reached",addOnUpgradeId:(0,o.ZP)(),tax:0})}function i(){s.Z.setState({open:!1})}function d(e){const t=s.Z.state;t.open&&s.Z.setState({...t,stage:"confirm_purchase",coupon:e&&!(0,a.$v)(e)?e:void 0})}function u(){s.Z.setState({open:!0,stage:"cancel_plan",addOnUpgradeId:(0,o.ZP)(),tax:0})}},71487:(e,t,n)=>{n.d(t,{A:()=>u,y:()=>d});var o=n(5366),a=n(54642),s=n(47307),r=n(33929);const i=(0,o.defineMessages)({invalidCoupon:{id:"applyCoupon.error.invalidCoupon",defaultMessage:"Unable to apply the coupon to your account."}});async function d(e,t){const{customerId:n,offerType:o}=t,r=await a.getCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===o?t.newPlan:void 0,offerType:o});if("failed"===r.type)s.showError(r);else{const e=r.data;if(e.offerType===o)return e.coupon}}async function u(e,t){const{customerId:n,coupon:o,offerType:d}=t;if(!o)return void s.showErrorMessage(r.default.formatMessage(i.invalidCoupon));const u=await a.applyCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===d?t.newPlan:void 0,offerType:d,coupon:o});"failed"===u.type&&s.showError(u)}},74011:(e,t,n)=>{n.r(t),n.d(t,{AddOnDiscountPopup:()=>O});var o=n(23174),a=n.n(o),s=n(67294),r=n(480),i=n(86628),d=n(24405),u=n(92595),c=n(11751),p=n(5366),f=n(3791),l=n(896),m=n(50906),g=n(39699),_=n(37181),y=n(77907),v=n(80444),S=n(78291),w=n(80671),P=n(71487),h=n(70060),A=n(43163),C=n(25225),b=n(35057);function O(){window.__c={n:"AddOnDiscountPopup"};const e=(0,r.O7)(),[t,n]=s.useState(void 0);(0,s.useEffect)((()=>{(0,u.exposeDebugValue)("resetAddOnDiscountPopup",(()=>{const{currentUserSettingsStore:t}=v.default.state;t&&g.createAndCommit({userAction:"AddOnDiscountPopup.resetAddOnPromoPopup",environment:e,perform:e=>{_.d2({userSettingsStore:t,transaction:e,data:{seen_ai_discount_popup:!1}})}})}))}),[e]);const{currentUserSettingsStore:o,currentSpaceStore:O}=(0,i.VK)((()=>v.default.state),[]),M=(0,i.VK)((()=>S.default.state.data),[]);(0,s.useEffect)((()=>{!async function(){var t;if(!O)return;if(!M)return;if(!(0,C.GJ)(M))return;if("unsubscribed_admin"!==M.type&&"subscribed_admin"!==M.type)return;if("stripe"!==(null===(t=M.customerData)||void 0===t?void 0:t.activeSubscriptionPlatform)||!M.customerData.stripe.isSubscribed)return;const o=C.XX(M);if((0,f.de)(null==o?void 0:o.addOns))return;const a=null!=o&&o.customerId?await P.y(e,{offerType:"add_on_upgrade_flow",customerId:o.customerId}):void 0;(0,l.pp)(a)&&n(a)}()}),[e,O,M]);const I=(0,s.useCallback)((()=>{o&&(g.createAndCommit({userAction:"AddOnDiscountPopup.markSeen",environment:e,perform:e=>{_.d2({userSettingsStore:o,transaction:e,data:{seen_ai_discount_popup:!0}})}}),m.Sh9(e))}),[o,e]),D=(0,s.useCallback)((()=>{t&&(w.k2(),w.Cl(t))}),[t]),k=(0,i.VK)((()=>!(!(0,l.pp)(t)||!(0,h.px)(e,(0,b.zt)()))),[t,e]),x=(0,d.yK)((e=>({icon:{width:20,height:20,fill:e.accentColors.purple[400]}})),[]);return k?a()(y.LazyFeatureIntroPopup,{calloutId:"add_on_discount_popup",initialPromo:{icon:c.t,iconStyle:x.icon,header:a()(p.FormattedMessage,{id:"AddOnDiscountPopup.header",defaultMessage:"Add unlimited AI for {percentage} off?",values:{percentage:(0,l.pp)(t)?(0,A.o)(t):void 0}}),description:a()(p.FormattedMessage,{id:"AddOnDiscountPopup.description",defaultMessage:"Project management is better with Notion AI. Add it on top of your paid plan with half off."})},steps:[],seenFeatureUserSetting:"seen_ai_discount_popup",userSettingsStore:o,allowExternalMouseEvents:!0,onDismiss:I,onTryFeatureClick:D,isUserEligible:k,onPopupSeen:()=>m.Cdl(e),onLearnMore:()=>{t&&D(),I()},ctaMessage:a()(p.FormattedMessage,{id:"AddOnDiscountPopup.purchase.button",defaultMessage:"Claim your deal"})}):null}},43163:(e,t,n)=>{n.d(t,{o:()=>i});var o=n(23174),a=n.n(o),s=(n(67294),n(5366)),r=n(97880);function i(e){switch(e){case"ai_fifty_percent":return a()(s.FormattedMessage,{id:"addOnUpgrade.confirmation.costSection.specialDiscounts.fiftyPercent",defaultMessage:"50%"});default:(0,r.t1)(e)}}},63423:(e,t,n)=>{n.d(t,{Z:()=>s});var o=n(49085);class a extends o.default{getInitialState(){return{open:!1}}}const s=new a}}]);