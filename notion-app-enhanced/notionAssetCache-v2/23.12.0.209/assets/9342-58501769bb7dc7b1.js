"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9342],{76463:(e,t,n)=>{n.d(t,{P0:()=>k,RN:()=>N,VG:()=>T,Yw:()=>P,jX:()=>F,k2:()=>B,lz:()=>A,v2:()=>_});var i=n(5366),o=n(26825),a=n(27006),s=n(45953),r=n(21202),l=n(77420),c=n(15047),d=n(19889),g=n(97880),u=n(47307),p=n(33929),m=n(67669),f=n(57559),v=n(54642),h=n(92625),y=n(76464),S=n(9953),b=n(64964),M=n(28014),I=n(39699),w=n(61202);const C=(0,i.defineMessages)({duplicatingTemplate:{id:"botActions.duplicatingTemplate.loadingMessage",defaultMessage:"Duplicating template..."},duplicatingTemplateError:{id:"botActions.duplicateTemplateAndShareWithBot.snackbar.failure",defaultMessage:"Failed to duplicate template for to your workspace"}});function Z(e,t){const{environment:n,spaceStore:i,spaceRole:o}=t,a=function(e){const{name:t,spaceStore:n,userId:i,icon:o,type:a}=e,s=Date.now(),r={name:t,created_at:s,created_by_table:d.KJ,created_by_id:i,alive:!0,icon:o,space_id:n.id,last_edited_at:s,last_edited_by_id:i,last_edited_by_table:d.KJ};switch(a){case"guest":return{...r,type:"guest",capabilities:e.capabilities,parent_table:c.bx,parent_id:n.id,integration_id:void 0};case"scim":return{...r,type:"scim",parent_table:d.KJ,parent_id:i};default:(0,g.t1)(a)}}(t),s=S.ae({environment:n,table:l.cZ,value:a,inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:e});return y.ep({environment:n,store:i,permissionItems:[{type:"bot_permission",role:o,bot_id:s.id}],transaction:e}),{botStore:s}}function A(e){const{environment:t}=e,{serverCommitResult:n,performResult:{botStore:i}}=I.createAndCommit({userAction:"botActions.createSpaceBot",environment:t,perform:t=>Z(t,e)});return{botStore:i,transactionPromise:n}}async function k(e){const{environment:t,botId:n,onSuccess:i}=e,o=await v.deleteBot(t,{botId:n});"failed"===o.type?u.showError(o):"success"===o.type&&i&&(await w.pJ({environment:t}),i())}async function P(e){const{environment:t,table:n,id:i,type:o}=e,a=await v.getBots(t,{table:n,id:i,type:o});if("failed"===a.type)throw u.showError(a),a;return{botIds:a.data.botIds,recordMap:a.data.recordMap}}async function T(e){const{environment:t,botId:n}=e,i=await v.getBotToken(t,{botId:n});if("failed"!==i.type)return i.data.token;u.showError(i)}function _(e){const{botValue:t,store:n,environment:i}=e,{id:a,parent_id:s,parent_table:r,capabilities:l}=t,c={type:"bot_permission",bot_id:a,parent_id:s,parent_table:r,role:(0,o.uH)(l)};I.createAndCommit({userAction:"TopbarMoreButton.handleAddingConnection",environment:i,perform:e=>{y.ep({environment:i,store:n,permissionItems:[c],transaction:e})}})}function N(e){const{botId:t,store:n,environment:i}=e,o=n.getPermissionItems().filter((0,g.AO)((e=>(0,a.FB)(e)?{true:e}:{false:e})));for(const a of o)if(a.bot_id===t){const e={...a,role:"none"};I.createAndCommit({userAction:"TopbarMoreButton.handleRemovingConnection",environment:i,perform:t=>{y.ep({environment:i,store:n,permissionItems:[e],transaction:t})}})}}function F(e){const{currentSpaceStore:t,environment:n,pages:i,botStore:o,addPermission:a}=e;if(!t)return;const s=(0,m.zT)({botStore:o,addPermission:a});i.forEach((e=>{const i=f.t1.createChildStore(t,{table:r.iU,id:e});I.createAndCommit({userAction:"botActions.updateBlockPermissionsForBot",environment:n,perform:e=>{y.ep({environment:n,store:i,permissionItems:[s],transaction:e})}})}))}async function B(e){const{environment:t,spaceStore:n,spaceViewStore:i,templatePageId:o,botValue:a,pages:r}=e;if(!n)return;const c=f.t1.createChildStore(n,{table:l.cZ,id:a.id});if(o)return await async function(e){const{environment:t,spaceStore:n,spaceViewStore:i,templatePageId:o,botStore:a}=e;if(!n||!i)return;try{h.j({message:C.duplicatingTemplate});const e=await v.loadBlockSubtree(t,{block:{id:o,spaceId:n.id},shallow:!1});if("failed"===e.type)return;const r=s.PF.create(e.data.subtreeRecordMap),{performResult:l}=I.createAndCommit({userAction:"botActions.duplicateTemplateAndShareWithBot",environment:t,perform:e=>{const s=M.cc({environment:t,recordMap:r,copyPageId:o,isPrivate:!0,spaceStore:n,spaceViewStore:i,transaction:e,allowCopyExternalObjectInstances:!1}),l=i.getPrivatePageIds();l.length>0&&S.sW({store:i,data:{private_pages:[s.id,...l]},transaction:e});const c=(0,m.zT)({botStore:a,addPermission:!0});return y.ep({environment:t,store:s,permissionItems:[c],transaction:e}),s}});return l}catch(r){b.oV({label:p.default.formatMessage(C.duplicatingTemplateError)})}finally{h.x()}}({environment:t,templatePageId:o,botStore:c,spaceStore:n,spaceViewStore:i});F({environment:t,currentSpaceStore:n,botStore:c,pages:r,addPermission:!0})}},22711:(e,t,n)=>{n.d(t,{C:()=>s,DP:()=>c,LN:()=>a,Lm:()=>l,Ow:()=>r,dt:()=>d});var i=n(50906),o=n(54642);async function a(e,t){const n=await o.getConnectedAppsStatus(e,{spaceId:t});if("failed"===n.type){const e=n.error;return console.error(e),{drive:[],evernote:void 0,trello:void 0,asana:void 0,confluence:void 0}}return n.data}async function s(e,t){await o.disconnectTrello(e,{}),await t.refresh(),i.qJZ(e,{integration_name:"trello"})}async function r(e,t){await o.disconnectAsana(e,{}),await t.refresh(),i.qJZ(e,{integration_name:"asana"})}async function l(e,t){await o.disconnectEvernote(e,{}),await t.refresh(),i.qJZ(e,{integration_name:"evernote"})}async function c(e,t,n){await o.disconnectConfluence(e,{spaceId:n}),await t.refresh()}async function d(e,t,n){await o.disconnectMonday(e,{spaceId:n}),await t.refresh()}},83805:(e,t,n)=>{n.d(t,{B:()=>M,e:()=>b});var i=n(515),o=n(64002),a=n(5366),s=n(50906),r=n(47307),l=n(95477),c=n(68821),d=n(91924),g=n(53833),u=n(90365),p=n(47593),m=n(67940),f=n(92083),v=n(54642),h=n(92625),y=n(15356);const S=(0,a.defineMessages)({authenticatingWithEvernote:{id:"evernoteActions.authenticatingWithEvernote.loadingMessage",defaultMessage:"Authenticating with Evernote…"},titleMessage:{defaultMessage:"Evernote login",id:"evernoteActions.loginPopupModal.title"}});async function b(e){const{environment:t,requestStore:n}=e,a=(0,d.eC)(t);let g=(0,i.Qp)(l.default.domainBaseUrl,{authType:a,userId:t.currentUser.id});g=a.redirectToAuth?g:await(0,d.HU)(t,g);const b=await y.M(t,{width:580,height:700,url:g,titleMessage:S.titleMessage});if(!b)return;const I=o.Qc(b),w=I.query.oauth_token,C=I.query.oauth_verifier;if(!w||!C)return;h.j({message:S.authenticatingWithEvernote});const Z=await v.authWithEvernote(t,{requestToken:w,verifier:C}),A=m.Z.getOrCreateFlowId();if("failed"===Z.type)return s.a1y(t,{import_source:"evernote",data:{import_type:"api",status:"failure",error:Z.error,userId:t.currentUser.id},flowId:A}),console.error(Z.error),r.showError(Z),void h.x();s.a1y(t,{import_source:"evernote",data:{import_type:"api",status:"success",userId:t.currentUser.id},flowId:A}),s.L3B(t,{integration_name:"evernote"}),await n.refresh(),u.Z.setState({open:!0}),(0,c.c)()?f.Z.setState({...f.Z.state,open:!0,currentTab:"imports",highlightedSetting:void 0,defaultSubtab:void 0}):p.Z.setState({open:!0}),await M({environment:t,requestStore:n}),h.x()}async function M(e){const{environment:t,requestStore:n}=e;try{g.Z.setState({...g.Z.state,isFetchingNotebooks:!0,showLoader:!0});const e=await v.getEvernoteNotebooks(t,{});if(await n.refresh(),"success"===e.type){g.Z.setState({...g.Z.state,notebooksResponse:e.data,isFetchingNotebooks:!1,showLoader:!1});const{userInfo:t,notebooks:n}=e.data;return{userInfo:t,notebooks:n}}return console.error(e.error),{notebooks:[],userInfo:void 0}}catch(i){return console.error(i),{notebooks:[],userInfo:void 0}}}},52192:(e,t,n)=>{n.d(t,{M:()=>b,u:()=>M});var i=n(515),o=n(64002),a=n(5366),s=n(50906),r=n(47307),l=n(95477),c=n(68821),d=n(91924),g=n(47593),u=n(82066),p=n(92083),m=n(81676),f=n(54642),v=n(84908),h=n(92625),y=n(15356);const S=(0,a.defineMessages)({authenticatingWithTrello:{id:"trelloActions.authenticatingWithTrello.loadingMessage",defaultMessage:"Authenticating with Trello…"},titleMessage:{defaultMessage:"Trello login",id:"trelloActions.loginPopupModal.title"}});async function b(e){const{environment:t,requestStore:n}=e,a=(0,d.eC)(t);let m=(0,i.ae)(l.default.domainBaseUrl,{authType:a,userId:t.currentUser.id,isElectronDevice:t.device.isElectron});if(m=a.redirectToAuth?m:await(0,d.HU)(t,m),t.device.isElectron)return void v.openExternalUrl(m);const b=await y.M(t,{width:580,height:700,url:m,titleMessage:S.titleMessage});if(!b)return;const I=o.Qc(b),w=I.query.oauth_token,C=I.query.oauth_verifier;if(!w||!C)return;h.j({message:S.authenticatingWithTrello});const Z=await f.authWithTrello(t,{requestToken:w,verifier:C});"failed"===Z.type?(console.error(Z.error),r.showError(Z),h.x()):(s.L3B(t,{integration_name:"trello"}),await n.refresh(),u.Z.setState({open:!0}),(0,c.c)()?p.Z.setState({...p.Z.state,open:!0,currentTab:"imports",highlightedSetting:void 0,defaultSubtab:void 0}):g.Z.setState({open:!0}),await M(t,n),h.x())}async function M(e,t){m.Z.setState({...m.Z.state,isFetchingBoards:!0,showLoader:!0});const n=await f.getTrelloBoards(e,{});return await t.refresh(),"success"===n.type?(m.Z.setState({...m.Z.state,boardsResponse:n.data,isFetchingBoards:!1,showLoader:!1}),n.data):(console.error(n.error),{boards:[]})}},35878:(e,t,n)=>{n.d(t,{cP:()=>De,ZP:()=>Be,a_:()=>Fe});var i=n(23174),o=n.n(i),a=(n(57658),n(67294)),s=n(13991),r=n(480),l=n(86628),c=n(24405),d=n(7057),g=n(77657),u=n(80920),p=n(74181),m=n(77420),f=n(9844),v=n(90965),h=n(94826),y=n(97880),S=n(82990),b=n(7928),M=n(5366),I=(n(95477),n(38755)),w=n(80444),C=n(57559),Z=n(20454),A=n(10434),k=n.n(A),P=n(15070),T=n(8848),_=n(58573),N=n(19889),F=n(50906),B=n(76463),D=n(75018),E=n(64964),x=n(39699),L=n(87279),U=n(18514),R=n(61766),V=n(74021),K=n(24736),W=n(26825),O=n(15025),q=n(28992);function z(e){window.__c={n:"BotCapabilitiesTooltip"};const{capabilities:t}=e,n=(0,M.useIntl)(),{device:i}=(0,r.O7)(),s=(0,W.uH)(t),l=(0,W.Rh)(t),c=(0,W.WM)(e.capabilities),d=[...(0,O.zq)(s),...(0,O.ac)(l),...(0,O.VR)(c)];return a.createElement(q.Z,k()({},e,{title:n.formatMessage((0,W.Gx)(s,void 0).label),shouldWrapCaption:!0,style:i.isMobile?{padding:"12px 4px"}:{padding:4,marginTop:2,marginBottom:2},captionStyle:{marginTop:4},caption:o()("div",{},void 0,d)}))}var j=n(52275),G=n(31945),H=n(68894),$=n(68785),J=n(78140),Y=n(32163),Q=n(50506),X=n(63296),ee=n(53437),te=n(72495),ne=n(64369),ie=n(29302);function oe(e){window.__c={n:"AdminIntegrationSettingsActionMenu"};const{integrationId:t,integrationTable:n,isLegacy:i,disableDisconnectUser:s,disableDisconnectAll:c,disableDisallow:d,botIds:u}=e,h=(0,l.VK)((()=>w.default.state.currentSpaceStore),[]),S=(0,r.Fy)(),b=(0,r.O7)(),I=(0,M.useIntl)(),A=be(),[P,T]=(0,a.useState)(void 0),[F,B]=(0,a.useState)(!1),[D,E]=(0,a.useState)(!1),[R,V]=(0,a.useState)(!1),[W,O]=(0,a.useState)(void 0),q=(0,l.VK)((()=>h&&n?(0,C.Kv)(h,{table:n,id:t}):void 0),[h,t,n]),z=(0,l.VK)((()=>{if(i){const e=p.ns.find((e=>e.id===t));return{name:null==e?void 0:e.name,url:(0,U.UY)("guides.connectedApps")}}if(h&&n){const i=h.getRecordModel({table:n,id:t});if(n===f.K2&&!(0,g.BP)({integrationId:t,env:"production"})){var e,o;const t=i;return{name:null==i?void 0:i.name,url:null==t||null===(e=t.getInfo())||void 0===e?void 0:e.website_url,email:null==t||null===(o=t.getInfo())||void 0===o?void 0:o.email}}return{name:null==i?void 0:i.name}}}),[h,t,n,i]),j=(0,l.VK)((()=>u&&!s?u.map((e=>h&&q?C.t1.createChildStore(q,{table:m.cZ,id:e,spaceId:h.id}):void 0)):[]),[h,u,q,s]).filter(y.$K),$=(0,l.VK)((()=>j.filter((e=>e.getAlive()))),[j]),X=(0,l.VK)((()=>{if(h&&$&&!s){return $.map((e=>e.getCreatedById())).filter(y.$K).map((e=>Z.U.createChildStore(h,{table:N.KJ,id:e}))).filter((e=>e.isDefined()))}return[]}),[$,h,s]),ee=(0,l.VK)((()=>null==h?void 0:h.getBotSettingsStore().getValue()),[h]),ne=(0,l.VK)((()=>null==$?void 0:$.reduce(((e,t)=>{const n=X.find((e=>e.id===t.getCreatedById()));return e[t.id]={userStore:n,botCapabilities:t.getCapabilities()},e}),{})),[$,X]),ie=(0,l.VK)((()=>P?(0,_.ZP)(P,Object.entries(ne),(e=>{let[,{userStore:t}]=e;return t.getSearchName(I)})):Object.entries(ne)),[ne,P,I]),oe=!s&&(null==u?void 0:u.length)&&o()(te.Z,{isInput:!0,style:{padding:8}},void 0,o()(H.ZP,{textWrapperStyle:{margin:0},focus:!S.isMobile||void 0,focusAfterAnimation:!0,value:P||"",onChange:e=>T(e.target.value),placeholder:I.formatMessage({id:"integrationInstallerFilter.userSearch.placeholder",defaultMessage:"Filter by user"})})),re=ie.length?[{key:"disconnect user section",render:e=>a.createElement(te.Z,e),items:se({users:ie,disableDisconnectUser:s,showDisplayModal:()=>E(!0),setSelectedUser:O,intl:I})}]:[],Se=(null==z?void 0:z.url)||(null==z?void 0:z.email),Me=Boolean(null==u?void 0:u.length)||(0,v.CJ)(ee)&&!d,Ie=a.createElement(a.Fragment,null,Se&&o()(te.Z,{topBorder:Boolean(ie.length)},"app-links",(null==z?void 0:z.url)&&o()(le,{environment:b,developerWebsite:z.url}),(null==z?void 0:z.email)&&o()(ce,{environment:b,developerEmail:z.email})),Me&&o()(te.Z,{topBorder:Boolean(ie.length||Se)},void 0,Boolean(null==u?void 0:u.length)&&o()(de,{showDisplayModal:()=>V(!0)}),(0,v.CJ)(ee)&&!d&&o()(ge,{showDisplayModal:()=>B(!0)})));return(Se||Me)&&z?o()(G.ZP,{popupType:S.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>a.createElement(K.Z,k()({},e,{isMobile:S.isMobile,style:{marginLeft:8,marginRight:8}})),render:()=>a.createElement(a.Fragment,null,o()(J.Z,{menuType:S.isMobile?L.og.ActionSheet:L.og.Popup,header:!s&&oe,footer:Ie,width:230},void 0,o()(Y.Z,{type:Y.i.Vertical,sections:re,initialFocus:void 0})),o()(Q.Z,{open:!s&&D,onDismiss:()=>{E(!1)},disableAnimation:!0,showCloseIcon:!0,innerStyle:A.innerModal,render:()=>o()(ue,{title:o()(he,{integrationName:z.name}),caption:o()(ye,{integrationName:z.name,userName:null==W?void 0:W.userName}),type:"disconnect",handleCancel:()=>{E(!1),O(void 0)},handleConfirmation:async()=>{W&&(await ae({botIds:[W.botId],environment:b}),O(void 0)),E(!1)}})}),o()(Q.Z,{open:!c&&R,onDismiss:()=>{V(!1)},disableAnimation:!0,showCloseIcon:!0,innerStyle:A.innerModal,render:()=>o()(ue,{title:o()(fe,{integrationName:z.name}),caption:o()(ve,{integrationName:z.name}),type:"disconnect",handleCancel:()=>V(!1),handleConfirmation:async()=>{await ae({botIds:u,environment:b}),V(!1)}})}),o()(Q.Z,{open:!d&&F,onDismiss:()=>{B(!1)},disableAnimation:!0,showCloseIcon:!0,innerStyle:A.innerModal,render:()=>o()(ue,{title:o()(pe,{integrationName:z.name}),caption:o()(me,{integrationName:z.name,disableDisconnectAll:c}),type:"disapprove",handleCancel:()=>B(!1),handleConfirmation:async()=>{!function(e){const{currentSpaceStore:t,environment:n,integrationId:i}=e;t&&x.createAndCommit({userAction:"AdminIntegrationSettingsActionMenu.handleDisapproveIntegration",environment:n,perform:e=>{x.applyOperation({store:t,operation:{pointer:t.pointer,path:["bot_settings","integration_approval_statuses"],command:"update",args:{[i]:null}},transaction:e})}})}({currentSpaceStore:h,environment:b,integrationId:t}),c||await ae({botIds:u,environment:b}),B(!1)}})}))}):null}async function ae(e){let{botIds:t,environment:n}=e;t&&await Promise.all(t.map((e=>B.P0({environment:n,botId:e,onSuccess:()=>{F.IN8(n,{type:"public"})}}))))}function se(e){const{intl:t,disableDisconnectUser:n,users:i,showDisplayModal:a,setSelectedUser:s}=e;return n?[]:i.map((e=>{let[n,{userStore:i,botCapabilities:r}]=e;return{key:i.id,render:e=>o()(re,{buttonMenuProps:e,userStore:i,botCapabilities:r,selectAction:()=>{a(),s({botId:n,userName:i.getDisplayName(t)})}}),action:()=>{a(),s({botId:n,userName:i.getDisplayName(t)})}}}))}function re(e){window.__c={n:"UserMenuActionItem"};const{buttonMenuProps:t,userStore:n,botCapabilities:i,selectAction:s}=e,l=(0,r.Fy)(),[c,d]=(0,a.useState)(!1);return o()(ee.ZP,{popupType:l.isMobile?G.Z4.SlideUp:G.Z4.Popup,placementToOrigin:G.pO.Right,open:c,onDismiss:()=>d(!1),origin:a.createElement(j.Z,k()({},t,{title:o()("div",{style:{display:"flex",alignContent:"center",justifyContent:"space-between"}},void 0,o()(ie.Z,{userStore:n,avatarSize:18,inline:!0,avatarShouldShowShadow:!0,style:{flexShrink:1}})),textWrapperStyle:{marginLeft:12,marginRight:12},focused:!1,onClick:()=>d(!0)})),render:()=>o()(J.Z,{width:240,menuType:l.isMobile?L.og.ActionSheet:L.og.Popup,header:o()("div",{style:{padding:2,marginTop:4,marginBottom:4}},void 0,o()(z,{capabilities:i}))},void 0,o()(Y.Z,{type:Y.i.Vertical,sections:[{key:"integration capabilities",render:e=>a.createElement(te.Z,k()({},e,{topBorder:!0})),items:[{key:"remove",render:e=>a.createElement(j.Z,k()({},e,{focused:!1,title:o()("div",{style:{color:T.ZP.red}},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.revokeUserAccess.label",defaultMessage:"Disconnect user"}))})),action:s}]}],initialFocus:void 0}))})}function le(e){let{environment:t,developerWebsite:n}=e;return o()(j.Z,{onClick:()=>{D.navigateToExternalURL({environment:t,url:n}),F.fco(t,{href:n,from:"integration-settings"})},title:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.visitDeveloperWebsite.label",defaultMessage:"Visit developer website"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12}})}function ce(e){let{environment:t,developerEmail:n}=e;return o()(j.Z,{onClick:()=>{D.navigateToExternalURL({environment:t,url:`mailto:${n}`}),F.Z9y(t,{from:"integration-settings"})},title:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.contactDeveloperSupport.label",defaultMessage:"Contact support"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12}})}function de(e){let{showDisplayModal:t}=e;return o()(j.Z,{onClick:t,title:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.label",defaultMessage:"Disconnect all users"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12,color:T.ZP.red}})}function ge(e){let{showDisplayModal:t}=e;return o()(j.Z,{onClick:t,title:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.label",defaultMessage:"Remove from approved list"}),focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12,color:T.ZP.red}})}function ue(e){let{title:t,caption:n,handleConfirmation:i,handleCancel:s,type:r}=e;window.__c={n:"ModalContent"};const[l,c]=(0,a.useState)(!1);return o()("div",{style:{padding:20,width:333}},void 0,o()(ne.Z,{isMultiline:!0,style:{marginBottom:8,fontWeight:S.Z.fontWeight.semibold,paddingRight:30}},void 0,t),o()(ne.Z,{isMultiline:!0,isSecondaryColor:!0,style:{marginBottom:8}},void 0,n),o()("div",{style:{display:"flex",marginTop:12}},void 0,o()(X.Z,{style:{width:140,marginRight:9},isLarge:!0,onClick:s,disabled:l},void 0,o()(ne.Z,{},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.cancel",defaultMessage:"Cancel"}))),o()(X.Z,{style:{width:140},isLarge:!0,onClick:async()=>await i(c),backgroundColor:T.ZP.red,disabled:l},void 0,o()(ne.Z,{style:{color:T.ZP.white}},void 0,"disconnect"===r&&!0===l&&o()($.Z,{isWhite:!0}),"disconnect"===r&&!1===l&&o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.disconnect",defaultMessage:"Disconnect"}),"disapprove"===r&&o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.remove",defaultMessage:"Remove"})))))}function pe(e){let{integrationName:t}=e;return o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.title",defaultMessage:"Remove {integrationName} from approved integrations",values:{integrationName:t}})}function me(e){let{integrationName:t,disableDisconnectAll:n}=e;return o()(M.FormattedMessage,n?{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.caption",defaultMessage:"Prevent members from installing {integrationName}.",values:{integrationName:t}}:{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApprovalAndDisconnectAll.caption",defaultMessage:"Revoke access for {integrationName} for all users in this workspace and prevent members from installing {integrationName}.",values:{integrationName:t}})}function fe(e){let{integrationName:t}=e;return o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.modal.label",defaultMessage:"Disconnect {integrationName} for all users in workspace",values:{integrationName:t}})}function ve(e){let{integrationName:t}=e;return o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.modal.caption",defaultMessage:"Revoke access for {integrationName} for all users in this workspace.",values:{integrationName:t}})}function he(e){let{integrationName:t}=e;return o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectUser.modal.label",defaultMessage:"Disconnect {integrationName}?",values:{integrationName:t}})}function ye(e){let{integrationName:t,userName:n}=e;return o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectUser.modal.caption",defaultMessage:"Revoke access for {integrationName} for {userName}",values:{integrationName:t,userName:n}})}function Se(e){window.__c={n:"AdminComplianceIntegrationSettingsActionMenu"};const{adminIntegrationConfig:t,botId:n,maybeWebhookSubscriptionId:i}=e,s=(0,r.Fy)(),c=(0,r.O7)(),[d,g]=(0,a.useState)(!1),u=be(),p=(0,l.VK)((()=>w.default.state.currentSpaceStore),[]),f=(0,l.VK)((()=>{const e=null==p?void 0:p.getRecordModel({table:m.cZ,id:n});return null==e?void 0:e.getCapabilities()}),[p,n]),v=t.developer_name;if(!v)return null;const y=new R.Z,S={key:"manage",action:()=>{V.Z.setState({open:!0,integrationId:t.id,webhookSubscriptionId:i}),y.setState({open:!1})},render:e=>a.createElement(j.Z,k()({},e,{title:o()(M.FormattedMessage,{id:"complianceIntegrationSettings.actionMenu.manage",defaultMessage:"Manage"})}))},b={key:"disconnect",action:()=>{y.setState({open:!1}),g(!0)},render:e=>a.createElement(j.Z,k()({},e,{title:o()("span",{style:u.disconnect},void 0,o()(M.FormattedMessage,{id:"complianceIntegrationSettings.actionMenu.disconnect",defaultMessage:"Disconnect"}))}))},I=[...t.oauth||(0,P.ms)(f)||(0,h.Uw)(t.id)?[]:[S],b];return a.createElement(a.Fragment,null,o()(G.ZP,{popupType:s.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>a.createElement(K.Z,k()({},e,{isMobile:s.isMobile,style:{marginLeft:8,marginRight:8}})),buttonPopupStore:y,render:()=>o()(J.Z,{menuType:s.isMobile?L.og.ActionSheet:L.og.Popup,width:230},void 0,o()(Y.Z,{type:Y.i.Vertical,sections:[{key:"options",render:e=>a.createElement(te.Z,e),items:I}],initialFocus:void 0}))}),o()(Q.Z,{open:d,onDismiss:()=>g(!1),disableAnimation:!0,showCloseIcon:!0,innerStyle:u.innerModal,render:()=>o()(ue,{title:o()(M.FormattedMessage,{id:"complianceIntegrationSettings.disconnectModal.title",defaultMessage:"Disconnect {integrationName}?",values:{integrationName:v}}),caption:o()(M.FormattedMessage,{id:"complianceIntegrationSettings.disconnectModal.subtitle",defaultMessage:"Revoke {integrationName}'s access to this workspace. Workspace events will no longer be sent to {integrationName}.",values:{integrationName:v}}),type:"disconnect",handleCancel:()=>g(!1),handleConfirmation:async()=>{await B.P0({environment:c,botId:n,onSuccess:()=>{}}),F.wi(c,{integration_id:t.id}),E.oV({label:o()(M.FormattedMessage,{id:"complianceIntegrationSettings.snackbar.title",defaultMessage:"Disconnected {integrationName} from your workspace",values:{integrationName:v}})})}})}))}function be(){return(0,c.yK)((()=>({disconnect:{color:T.ZP.red},innerModal:{borderRadius:10}})),[])}var Me=n(74136),Ie=n(31278),we=n(69219),Ce=n(26388),Ze=n(45653),Ae=n(59054),ke=n(4615),Pe=n(14871);function Te(e){window.__c={n:"InternalIntegrationActionMenu"};const{botId:t}=e,[,,n]=(0,l.AF)(void 0,R.Z),i=(0,r.Fy)(),s=(0,r.O7)(),c=(0,l.VK)((()=>w.default.state.currentSpaceStore),[]),[d,g]=(0,a.useState)(!1),u=(0,l.VK)((()=>c?C.t1.createChildStore(c,{table:m.cZ,id:t,spaceId:c.id}):void 0),[t,c]),p=(0,l.VK)((()=>(0,P.Mh)(null==u?void 0:u.getModel())),[u]),[{value:f}]=(0,Ae.r5)((async()=>{if(u){return await B.VG({environment:s,botId:null==u?void 0:u.id})}}),[s,u]);if(!u)return null;let v;return v=i.isMobile?{menuType:L.og.ActionSheet}:{menuType:L.og.Popup},o()(G.ZP,{popupType:i.isMobile?G.Z4.SlideUp:G.Z4.Popup,buttonPopupStore:n,renderOrigin:e=>a.createElement(K.Z,k()({isMobile:i.isMobile},e,{style:{marginLeft:8,marginRight:8}})),render:()=>a.createElement(a.Fragment,null,a.createElement(J.Z,v,o()(Y.Z,{type:Y.i.Vertical,sections:[{key:"integration options",render:e=>a.createElement(te.Z,e),items:[...f?[_e({environment:s,botToken:f})]:[],{key:"manage",action:()=>D.navigate({environment:s,url:`/my-integrations/internal/${ke.cj(t)}`,openInNew:"tab"}),render:e=>a.createElement(j.Z,k()({title:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.manageIntegration.label",defaultMessage:"Manage in developer portal"})},e))},{key:"delete",action:()=>g(!0),render:e=>a.createElement(j.Z,k()({title:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectIntegrationButton.label",defaultMessage:"Disconnect {integrationName}",values:{integrationName:p}}),style:{color:T.ZP.red}},e))}]}],initialFocus:void 0})),o()(Q.Z,{open:d,onDismiss:()=>{g(!1)},disableAnimation:!0,render:()=>o()("div",{style:{padding:20,width:333}},void 0,o()(ne.Z,{isMultiline:!0,style:{marginBottom:8,fontWeight:S.Z.fontWeight.semibold}},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegration.modal.label.title",defaultMessage:"Disconnect {integrationName} in workspace",values:{integrationName:p}})),o()(ne.Z,{isMultiline:!0,isSecondaryColor:!0,style:{marginBottom:8}},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegration.modal.label.caption",defaultMessage:"Revoke access for {integrationName} in workspace",values:{integrationName:p}})),o()("div",{style:{display:"flex",marginTop:12}},void 0,o()(X.Z,{style:{width:140,marginRight:9},isLarge:!0,onClick:()=>g(!1)},void 0,o()(ne.Z,{},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.cancel",defaultMessage:"Cancel"}))),o()(X.Z,{style:{width:140},isLarge:!0,onClick:async()=>{g(!1),await B.P0({environment:s,botId:u.id,onSuccess:()=>{F.IN8(s,{type:"internal"})}})},backgroundColor:T.ZP.red},void 0,o()(ne.Z,{style:{color:T.ZP.white}},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectIntegration..modal.button.disconnect",defaultMessage:"Disconnect"})))))}))})}function _e(e){const{botToken:t,environment:n}=e;return{key:"copy bot token",action:()=>{Pe.RD({environment:n,stringValue:t,copiedMessage:Pe.tq.copiedLinkToClipboard}),F.IVn(n,{from:"integration-settings",table:m.cZ})},render:e=>a.createElement(j.Z,k()({title:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.copyInternalIntegrationTokenButton.label",defaultMessage:"Copy internal integration token"})},e))}}var Ne=n(40235);const Fe={internal:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.internal",defaultMessage:"INTERNAL"}),databaseSync:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.sync",defaultMessage:"SYNC"}),linkPreview:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.preview",defaultMessage:"LINK PREVIEW"}),importer:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.importer",defaultMessage:"IMPORTER"}),dlp:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.dlp",defaultMessage:"DLP"}),siem:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.siem",defaultMessage:"SIEM"}),ediscovery:o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.ediscovery",defaultMessage:"eDISCOVERY"})};function Be(e){window.__c={n:"AdminIntegrationSettingsTable"};const{integrationIdToBotIds:t,internalIntegrationIds:n,integrationIdToUsers:i}=e,s=(0,l.VK)((()=>w.default.state.currentSpaceStore),[]),r=(0,c.Fg)(),d=(0,l.VK)((()=>null==s?void 0:s.getBotSettingsStore().getValue()),[s]),u=(0,l.VK)((()=>"approved_or_built_by_notion"===(null==d?void 0:d.integration_restrictions)),[d]),h=(0,l.VK)((()=>Boolean(null==d?void 0:d.integration_restrictions)),[d]),y=(0,l.VK)((()=>null!=d&&d.integration_approval_statuses?Object.keys(d.integration_approval_statuses):[]),[d]),S=y.filter((e=>!Object.keys(t).includes(e)&&!p.T2.includes(e))),b=S.some((e=>e===g.f3)),I=(0,l.VK)((()=>null==s?void 0:s.id),[s]),C=t?Object.entries(t).map((e=>{let[t,n]=e;return Ee({integrationPointer:{table:f.K2,id:t},userStores:i[t],botIds:n,autoApproveBuiltByNotion:u})})):[],Z=I?n.map((e=>Ee({integrationPointer:{table:m.cZ,id:e,spaceId:I},userStores:i[e],botIds:[e]}))):[],A=h?S.map((e=>Ee({integrationPointer:{table:f.K2,id:e},userStores:[],botIds:[],autoApproveBuiltByNotion:u}))):[],k=p.ns.filter((e=>!(0,v.CJ)(d)||y.includes(e.id)&&(e.id!==p._o||!b))).map((e=>function(e){const{legacyIntegration:t}=e,{id:n,name:i,info:a}=t;return{key:n,columns:[o()("div",{style:{display:"flex",alignItems:"center",maxWidth:300}},0,o()("img",{src:a.icon,style:{height:28}}),o()("div",{style:{minWidth:0,marginLeft:15}},void 0,o()("div",{style:{display:"flex"}},void 0,o()(ne.Z,{},void 0,i)),o()(ne.Z,{isSmall:!0,style:{display:"flex"}},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.legacy",defaultMessage:"Notion Connected App"})))),o()(We,{renderedUsers:void 0,displayUsers:!1},1),o()("div",{},2,o()(oe,{integrationId:n,isLegacy:!0,disableDisconnectAll:!0,disableDisconnectUser:!0}))]}}({botSettings:d,legacyIntegration:e}))),P=C.length+Z.length+A.length+k.length;return a.createElement(a.Fragment,null,o()(Ne.Z,{columns:[{key:"integration",header:o()(M.FormattedMessage,{id:"spaceConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"40%"}},{key:"added_by",header:o()(M.FormattedMessage,{id:"spaceConnectionsSettings.connectionsTable.creationInfoColumn.title",defaultMessage:"Users and access"})},{key:"more",header:void 0,style:{width:"5%"}}],rows:[...C,...Z,...A,...k]}),0===P?o()("div",{style:{height:120,width:"100%",fontSize:12,color:r.lightTextColor,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:`1px solid ${r.lightDividerColor}`}},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.emptyTable.message",defaultMessage:"No integration installed"})):void 0)}function De(e){window.__c={n:"AdminIntegrationComplianceSettingsTable"};const{botIdToWebhookSubscriptionId:t,complianceIntegrationsIdToBotIds:n}=e,i=(0,c.yK)((e=>({emptyTable:{height:120,width:"100%",fontSize:12,color:e.lightTextColor,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:`1px solid ${e.lightDividerColor}`}})),[]),s=(0,l.VK)((()=>w.default.state.currentSpaceStore),[]),r=(0,l.VK)((()=>{if(!s)return[];return Object.entries(n).flatMap((e=>{let[n,i]=e;return i.map((e=>{const i=C.Qx.createChildStore(s,{table:m.cZ,id:e,spaceId:s.id});return{integrationPointer:{table:f.K2,id:n},botId:e,lastEditedAt:Number(i.getLastEditedAt()),lastEditedByPointer:i.getLastEditedByPointer(),webhookSubscriptionId:t[e]}}))})).filter(y.$K)}),[t,s,n]).map((e=>function(e){const{integrationPointer:t,lastEditedAt:n,lastEditedByPointer:i,botId:a,webhookSubscriptionId:s}=e,r=t.id,l=(0,h.EY)(r);if(!l)return;const c=h.ZB[l];if(!c)return;return{key:`${r}:${a}`,columns:[o()(xe,{integrationTable:f.K2,integrationId:r},"integration-title"),o()(Ve,{lastEditedByPointer:i},"integration-installer"),o()(Ke,{installedAt:n},"integration-installed-at"),o()(Se,{adminIntegrationConfig:c,maybeWebhookSubscriptionId:s,botId:a},"integration-menu")]}}(e))).filter(y.$K);return a.createElement(a.Fragment,null,o()(Ne.Z,{columns:[{key:"integration",header:o()(M.FormattedMessage,{id:"spaceConnectionsSettings.complianceConnectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"35%"}},{key:"integration-installer",header:o()(M.FormattedMessage,{id:"spaceConnectionsSettings.complianceConnectionsTable.integrationInstallerColumn.title",defaultMessage:"Added by"}),style:{width:"20%"}},{key:"integration-installed-at",header:o()(M.FormattedMessage,{id:"spaceConnectionsSettings.complianceConnectionsTable.integrationDateAdded.title",defaultMessage:"Date added"})},{key:"more",header:void 0,style:{width:"5%"}}],rows:r,tableStyle:{borderTop:"none"}}),0===r.length?o()("div",{style:i.emptyTable},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.emptyTable.message",defaultMessage:"No integration installed"})):void 0)}function Ee(e){const{integrationPointer:t,userStores:n,botIds:i,autoApproveBuiltByNotion:a}=e;if(t.table===f.K2){const e=t.id,s=(0,g.BP)({integrationId:e,env:"production"});return{key:e,columns:[o()(xe,{integrationTable:f.K2,integrationId:e},"integration-title"),o()(We,{renderedUsers:n,displayUsers:!s},"integration-installer-info"),o()(oe,{integrationId:e,integrationTable:f.K2,botIds:i,disableDisconnectUser:s||void 0,disableDisallow:s&&a},"admin-integration-settings-menu")]}}if(t.table===m.cZ)return{key:t.id,columns:[o()(xe,{integrationTable:m.cZ,integrationId:t.id},"integration-title"),o()(We,{renderedUsers:n,displayUsers:!1},"integration-installer-info"),o()(Te,{botId:t.id},"integration-settings-menu")]};(0,y.t1)(t)}function xe(e){window.__c={n:"IntegrationTitle"};const{integrationId:t,integrationTable:n}=e,i=(0,l.VK)((()=>w.default.state.currentSpaceStore),[]),a=(0,l.VK)((()=>{if(i)return i.getRecordModel({table:n,id:t})}),[i,t,n]),[s,r,c,d]=(0,l.VK)((()=>{if(!a)return[];let e;const i=[];let s;if(n===m.cZ){const r=a;r.icon&&(e={pointer:{table:n,id:t},icon:r.icon}),i.push("internal"),s=o()(Le,{botId:r.id})}else if(n===f.K2){const r=a,l=r.getInfo();l.icon&&(e={pointer:{table:n,id:t},icon:l.icon}),(0,p.mo)(r)&&(i.push("linkPreview"),(0,p.zc)(r)&&i.push("databaseSync")),s=(0,h.z6)(r.id)?null:o()(Ue,{integrationId:r.id})}else(0,y.t1)(n);return[null==a?void 0:a.name,e,i,s]}),[n,t,a]);return a&&c?o()("div",{style:{display:"flex",alignItems:"center",maxWidth:300}},void 0,o()(Ie.Z,{disabled:!0,icon:r,title:s,isEmptyPage:!1,size:28,isLarge:!0,useInvertedColors:!0}),o()("div",{style:{minWidth:0,marginLeft:15}},void 0,o()("div",{style:{display:"flex",marginRight:16}},void 0,o()(ne.Z,{},void 0,s),c.map((e=>e&&o()(Me.Z,{desktopStyle:{marginLeft:4}},e,Fe[e])))),d)):o()($.Z,{})}const Le=e=>{let{botId:t}=e;window.__c={n:"InternalIntegrationDeveloperName"};const n=(0,l.VK)((()=>w.default.state.currentSpaceStore),[]),i=(0,M.useIntl)(),a=(0,l.VK)((()=>null==n?void 0:n.getRecordModel({table:m.cZ,id:t})),[n,t]),s=(0,l.VK)((()=>{if(n&&a){const e=n.getRecordModel({table:a.created_by_table,id:a.created_by_id});return(0,b.Nz)(i,e)}}),[n,a,i]);return s?o()(ne.Z,{className:"notranslate",isSmall:!0},void 0,s):o()(Re,{})},Ue=e=>{let{integrationId:t}=e;window.__c={n:"PublicIntegrationDeveloperName"};const n=(0,l.VK)((()=>w.default.state.currentSpaceStore),[]),i=(0,c.Fg)(),s=(0,l.VK)((()=>{const e=null==n?void 0:n.getRecordModel({table:f.K2,id:t});return null==e?void 0:e.getInfo().developer_name}),[n,t]);return(0,g.BP)({integrationId:t,env:"production"})?o()(ne.Z,{isSmall:!0,style:{display:"flex",alignItems:"center"}},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.notion",defaultMessage:"Notion {icon}",values:{icon:o()(Ce.Z,{renderTooltip:()=>o()("div",{},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfo.notion.tooltip",defaultMessage:"Developed by Notion"})),placement:Ce.Z.Placement.Right,render:e=>a.createElement("div",e,(0,u.X)({width:12,height:12,fill:i.invoiceGreen}))})}})):s?o()(ne.Z,{className:"notranslate",isSmall:!0},void 0,s):o()(Re,{})},Re=()=>o()(ne.Z,{isSmall:!0},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.label.unverifiedDeveloper",defaultMessage:"Unverified developer"}));function Ve(e){window.__c={n:"AdminComplianceInstaller"};const{lastEditedByPointer:t}=e,n=(0,M.useIntl)(),i=(0,l.VK)((()=>{const e=w.default.state.currentSpaceStore;if(e)return e&&t?Z.U.createChildStore(e,t):void 0}),[t]),a=(0,l.VK)((()=>null==i?void 0:i.getDisplayName(n)),[i,n]);return i&&a?o()("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",gap:8,alignItems:"center",width:"100%"}},void 0,o()(Ze.Z,{userStore:i,size:18}),o()(ne.Z,{},void 0,a)):null}function Ke(e){const{installedAt:t}=e;return void 0===t?null:o()(we.i,{useThinTitle:!0,title:(0,d.Yx)(t,"medium_with_time",s.SP)})}function We(e){window.__c={n:"IntegrationInstallerInfo"};const{renderedUsers:t,displayUsers:n}=e,i=(0,l.VK)((()=>w.default.state.currentSpaceStore),[]),s=(0,M.useIntl)(),c=(0,r.O7)(),d=(0,l.VK)((()=>{if(i)return(0,I.rn)(c,i)}),[c,i]),g=(0,a.useMemo)((()=>t&&t.length),[t]),u=(0,l.VK)((()=>t&&t.length>0?t[0]:void 0),[t]),p=(0,l.VK)((()=>u?u.getDisplayName(s):void 0),[u,s]);return n&&void 0!==g?u?o()("div",{style:{display:"flex",alignItems:"center"}},void 0,o()(Ze.Z,{userStore:u,avatarShouldShowShadow:!0,style:{marginRight:8},size:28}),o()(ne.Z,{},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.listOfUsers",defaultMessage:"{remainingCount, plural, =0 {{firstUser}} one {{firstUser} +{remainingCount}} other {{firstUser} +{remainingCount}}}",values:{firstUser:p,remainingCount:g-1}}))):o()(ne.Z,{isSecondaryColor:!0,style:{display:"flex",alignItems:"center"}},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.noUsers",defaultMessage:"No users"})):o()(ne.Z,{style:{display:"flex",alignItems:"center"}},void 0,o()(M.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.anyone",defaultMessage:"Anyone in {spaceName}",values:{spaceName:o()(ne.Z,{style:{fontWeight:S.Z.fontWeight.medium}},void 0,d)}}))}},73084:(e,t,n)=>{n.d(t,{Z:()=>$});var i=n(23174),o=n.n(i),a=n(10434),s=n.n(a),r=(n(57658),n(67294)),l=n(83355),c=n(480),d=n(86628),g=n(49085),u=n(8848),p=n(35840),m=n(27006),f=n(21202),v=n(29369),h=n(5366),y=n(94507),S=n(65452),b=n(28020),M=n(98165),I=n(38755),w=n(80444),C=n(57559),Z=n(2834),A=n(52275),k=n(60458),P=n(31278),T=n(76798),_=n(14694);class N extends Z.Z{renderComponent(){const{nestingLevel:e}=this.props;return r.createElement(A.Z,s()({},this.props,{title:o()(_.Z,{childrenStyle:N.sidebarChildrenStyle,left:this.renderLeftCheckbox(),icon:this.renderIcon(),style:{marginLeft:8*e}},void 0,this.renderTitle())}))}renderLeftCheckbox(){return o()(k.Z,{size:16,checked:this.props.isChecked,onClick:this.props.onClick})}renderIcon(){const{store:e,isMobile:t}=this.props,n=e.getIcon();return o()(P.Z,{disabled:!0,icon:n,title:void 0,isEmptyPage:e.isEmptyPage(),size:t?24:20,pageIconStyle:{fill:this.theme.mediumIconColor}})}renderTitle(){return o()(T.Z,{store:this.props.store})}}N.sidebarChildrenStyle={display:"flex",alignItems:"center"};const F=N;var B=n(68894),D=n(68785),E=n(32163),x=n(53437),L=n(72495),U=n(59054),R=n(97880),V=n(31299),K=n(87279),W=n(78140),O=n(43765),q=n(11470),z=n(78948);function j(e){window.__c={n:"OauthPageSearchResults"};const{spaceId:t,onSelectPage:n,query:i,source:a,findSelectedBlockAncestorId:l}=e,d=(0,c.O7)();let g=null;const[{status:u,value:p}]=(0,U.r5)((async()=>await V.D7({environment:d,query:i,limit:10,requireEditPermissions:!0,spaceId:t,excludeTemplates:!0,source:a,boostRecentlyViewedPages:!1})),[d,i,t,a],{debounce:V.vp});if("idle"===u||"pending"===u)g=o()(L.Z,{},void 0,o()(z.Z,{}));else{const e=((null==p?void 0:p.results)||[]).map((e=>{let{id:t}=e;const i=new C.G(d,{table:f.iU,id:t});return function(e){const{store:t,environment:n,alreadySelectedAncestorId:i,onSelectPage:a}=e;if(i&&i===t.id)return{key:t.id,action:()=>{},render:e=>r.createElement(q.Z,s()({},e,{store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:o()(h.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.bySelf.message",defaultMessage:"Already added"})}))};if(i){const e=new C.G(n,{table:f.iU,id:i});return{key:t.id,action:()=>{},render:n=>r.createElement(q.Z,s()({},n,{store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:o()(h.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.byAncestor.message",defaultMessage:"Already added via {ancestorPageName}",values:{ancestorPageName:o()(T.Z,{store:e,style:{display:"inline"}})}})}))}}const l=t.getRole();return l&&m.zz(l)?{key:t.id,action:()=>a(t.id),render:e=>r.createElement(q.Z,s()({store:t,hidePath:!1},e))}:void 0}({store:i,alreadySelectedAncestorId:l(i),environment:d,onSelectPage:n})})).filter(R.$K);g=0===e.length?o()(L.Z,{},void 0,o()(O.Z,{title:o()(h.FormattedMessage,{id:"oauthPageSearchResults.noResults.placeholder",defaultMessage:"No results"})})):function(e){return o()(E.Z,{type:E.i.Vertical,initialFocus:void 0,sections:[{key:"results",items:e,render:e=>r.createElement(L.Z,e)}]})}(e)}const v={menuType:K.og.Popup};return r.createElement(W.Z,v,g)}class G extends l.Z{constructor(){super(...arguments),this.storeTypes={selectedBlockIdsStore:g.default.createClass({}),searchStore:g.default.createClass({open:!1,query:void 0})},this.getPageSection=(e,t,n)=>{const i=n.filter((e=>m.zz(e.getRole()||"none")));return{key:e,render:e=>r.createElement(L.Z,e),items:[this.getPageSectionHeader(t,i),...0===i.length?[this.getEmptyState()]:i.map((e=>this.getPageItem(e,1)))]}},this.getPageItem=(e,t)=>{const{selectedBlockIdsStore:n}=this.stores,{device:i}=this.environment,o=Boolean(n.state[e.id]);return{key:e.id,action:()=>this.handleClickPage(e.id,o),render:n=>r.createElement(F,s()({},n,{isMobile:i.isMobile,store:e,isChecked:o,disabled:!1,nestingLevel:t}))}},this.getPageSectionHeader=(e,t)=>{const{selectedBlockIdsStore:n}=this.stores,i=t.length>0&&t.every((e=>n.state[e.id]));return{key:e,action:()=>this.handleClickSection(t),render:t=>r.createElement(A.Z,s()({},t,{title:o()(_.Z,{left:o()(k.Z,{onClick:t.onClick,checked:i,size:16}),style:this.getSectionHeaderStyle()},void 0,e)}))}},this.getEmptyState=()=>({key:"empty",action:()=>{},render:e=>r.createElement(A.Z,s()({},e,{title:o()(_.Z,{style:{fontSize:14,color:this.theme.mediumTextColor,padding:"2px 32px"}},void 0,o()(h.FormattedMessage,{id:"oauthAuthorizationPage.selectPageStep.empty",defaultMessage:"No pages inside"}))}))}),this.handleClickPage=(e,t)=>{const{selectedBlockIdsStore:n}=this.stores;n.setState({...n.state,[e]:!t})},this.handleClickSection=e=>{const{selectedBlockIdsStore:t}=this.stores,n=e.every((e=>t.state[e.id]));t.setState({...t.state,...e.reduce(((e,t)=>(e[t.id]=!n,e)),{})})},this.handleSearchQueryChange=e=>{const t=this.stores.searchStore.state,n=e.length>0;this.stores.searchStore.setState({...t,query:e,open:n})},this.handleSearchCancel=()=>{const e=this.stores.searchStore.state;this.stores.searchStore.setState({...e,open:!1,query:void 0})},this.findSelectedBlockAncestorId=e=>{const{selectedBlockIdsStore:t}=this.stores;if(t.state[e.id])return e.id;const n=M.fJ(e).find((e=>e.table===f.iU&&Boolean(t.state[e.value.id])));return n?n.value.id:void 0}}renderComponent(){const{intl:e}=this.props,{searchStore:t,selectedBlockIdsStore:n}=this.stores,i=(0,b.k_)(this.environment).state;if(!i)return o()(D.Z,{style:{alignSelf:"center"}});const{allSharedPagesStores:a,showWorkspaceSection:l,showTeamSection:c,showSharedSection:d,showPrivateSection:g,showOnlyPrivateSection:u}=i,{currentSpaceViewStore:m,currentSpaceStore:y}=w.default.state;if(!m||!y)return;const S=[];if(c){const e=m.getTeamsStores();S.push(...e.map((e=>[e,e.getTeamPagesStores().filter(H)])))}const M=m.getWorkspacePages().filter(H),Z=m.getPrivatePages(this.environment).filter(H),A=Object.keys(n.state).filter((e=>n.state[e])).map((e=>new C.G(this.environment,{table:f.iU,id:e}))).filter((e=>e.getSpaceId()===y.id&&e.isNavigableBlock()&&!e.isTopLevelPrivatePage({spaceStore:y,environment:this.environment})&&!e.isTopLevelWorkspacePage(y.id)&&!(e.getParentTable()===v.e0)&&!a.some((t=>t.id===e.id)))),k=(0,I.rn)(this.environment,y),P=[];if(A.length>0&&P.push({key:"manual",render:e=>r.createElement(L.Z,s()({},e,{title:o()(_.Z,{style:this.getSectionHeaderStyle()},void 0,o()(h.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.pagePicker.manuallyAddedPagesSection.title",defaultMessage:"Manually added"})),isTitleUppercase:!0})),items:A.map((e=>this.getPageItem(e,0)))}),l&&P.push(this.getPageSection("workspace",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.workspaceSection.title",defaultMessage:"Workspace"}),M)),c)for(const[o,s]of S){const e=o.id,t=o.getName();e&&void 0!==t&&P.push(this.getPageSection(`team-${e}`,t,s))}if(d&&P.push(this.getPageSection("shared",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.sharedSection.title",defaultMessage:"Shared"}),a)),g){const t=u?k||"":e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.privateSection.title",defaultMessage:"Private"});P.push(this.getPageSection("private",t,Z))}const T=this.getSearchIconStyle();return r.createElement(r.Fragment,null,o()(x.GI,{origin:o()(B.ZP,{style:{marginBottom:8},itemMarginLeft:0,itemMarginRight:0,focus:!0,focusAfterAnimation:!0,value:t.state.query||"",onChange:e=>{this.handleSearchQueryChange(e.target.value)},placeholder:e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.search.placeholder",defaultMessage:"Search for pages in {workspaceName}"},{workspaceName:k}),inputLeft:(0,p.R)(T)}),sameWidthAsOrigin:!0,popupType:x.GI.PopupType.Popup,open:t.state.open,render:()=>o()(j,{spaceId:y.id,onSelectPage:e=>this.handleClickPage(e,!1),query:t.state.query||"",source:"oauth",findSelectedBlockAncestorId:this.findSelectedBlockAncestorId}),onDismiss:this.handleSearchCancel}),o()("div",{style:this.getPageListStyle()},void 0,o()(E.Z,{type:E.i.Vertical,sections:P,initialFocus:void 0})))}getSectionHeaderStyle(){return{textTransform:"uppercase",fontSize:12,fontWeight:600,color:u.ZP.mediumTextColor,padding:"2px 0"}}getPageListStyle(){return{alignItems:"left",width:"100%",height:380,borderWidth:1,borderStyle:"solid",borderColor:u.ZP.contentBorder,borderRadius:4,overflowY:"auto"}}getSearchIconStyle(){return{width:14,height:14,marginLeft:8,marginRight:8,flexGrow:0,flexShrink:0,fill:u.ZP.mediumIconColor}}}function H(e){return e.isDefined()&&"copy_indicator"!==e.getType()}G.displayName="BotAccessPagePicker";const $=function(e){window.__c={n:"BotAccessPagePickerWrapper"};const t=(0,c.O7)(),n=(0,d.VK)((()=>{var e;return null===(e=w.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),i=t.currentUser.id,o=(0,h.useIntl)();return(0,d.VK)((()=>{n&&i&&(S.h({environment:t,spaceId:n,userId:i}),y.I({environment:t,spaceId:n,userId:i}))}),[t,n,i]),r.createElement(G,s()({intl:o},e))}},94512:(e,t,n)=>{n.d(t,{Z:()=>S});var i=n(23174),o=n.n(i),a=n(67294),s=n(480),r=n(24405),l=n(97880),c=n(82990),d=n(5366),g=n(50906),u=n(35878),p=n(64921),m=n(61519),f=n(74420),v=n(74136),h=n(89728),y=n(23189);function S(e){window.__c={n:"ConnectedAppsSettingsDiscoverSection"};const{apps:t,numberOfConnectedApps:n,showSubtitle:i}=e,r=(0,s.O7)(),[c,u]=(0,a.useState)(!1),p=t.filter((e=>!e.shouldHideInDiscover)),f=p.length>3&&!c,v=c?p:p.slice(0,3);return a.createElement(a.Fragment,null,o()(y.Z,{large:!0,divider:"none"},void 0,o()("div",{style:{display:"flex",justifyContent:"space-between",height:28,fontSize:16,fontWeight:510}},void 0,o()(d.FormattedMessage,{id:"connectionsSettings.discoverNewConnectionsSection.title",defaultMessage:"Discover new connections"})),i&&o()("span",{style:{fontSize:14,marginRight:8,color:"#787774",fontWeight:400}},void 0,o()(d.FormattedMessage,{id:"admin.connections.tab.workspace_connections.header",defaultMessage:"These integrations connect your workspace to external apps, or improve security and compliance. Only workspace owners can install them."}))),o()("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12}},void 0,v.map((e=>{var t;return"string"==typeof e.logo&&e.onConnect&&o()(b,{appName:e.appName,caption:e.caption,shouldShowNewBadge:e.shouldShowNewBadge,logo:e.logo,integrationTypes:null===(t=e.integrationTypes)||void 0===t?void 0:t.slice(0,2),onConnect:e.onConnect},e.id)})).filter((e=>(0,l.$K)(e)))),f&&o()(h.Z,{style:{marginTop:10,gap:10,marginLeft:-8},isGray:!0,onClick:()=>{c||(u(!0),g.EUq(r,{numberOfConnectedApps:n}))}},void 0,o()(d.FormattedMessage,{id:"connectedAppsSettings.discoverNewAppSection.showAll.label",defaultMessage:"Show all"})),o()(m.Z,{size:16,style:{marginTop:16}}))}function b(e){window.__c={n:"ConnectedAppsSettingsDiscoverItem"};const{appName:t,caption:n,logo:i,shouldShowNewBadge:a,integrationTypes:s,onConnect:l}=e,g=(0,r.yK)((e=>({card:{display:"flex",flexDirection:"column",borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:"#E3E2E0",padding:16,height:"100%"},image:{width:40,height:40,borderRadius:3,float:"left"},titleAndPillContainer:{display:"block",float:"left",marginLeft:4},titleAndNewBadgeContainer:{alignItems:"center",display:"flex",marginLeft:4},title:{fontWeight:c.Z.fontWeight.medium,fontSize:16},caption:{marginTop:8,fontWeight:c.Z.fontWeight.regular,color:e.mediumTextColor,fontSize:12,maxHeight:72,overflow:"hidden"},pillContainer:{display:"flex"},pill:{marginLeft:4},cardHover:{borderRadius:6},button:{marginLeft:-8,marginTop:3},buttonHover:{background:"transparent"},pressedStyle:{background:"transparent"}})),[]);return o()(p.Z,{onClick:l,hoveredStyle:g.cardHover},void 0,o()("div",{style:g.card},void 0,o()("div",{},void 0,o()("img",{style:g.image,src:i}),o()("div",{style:g.titleAndPillContainer},void 0,o()("div",{style:g.titleAndNewBadgeContainer},void 0,o()("div",{style:g.title},void 0,t),a&&o()(f.Z,{})),o()("div",{style:g.pillContainer},void 0,null==s?void 0:s.map((e=>e&&o()("div",{style:g.pill},e,o()(v.Z,{},void 0,u.a_[e]))))))),o()("div",{style:g.caption},void 0,n),o()("div",{style:g.button},void 0,o()(h.Z,{isBlue:!0,hoveredStyle:g.buttonHover,pressedStyle:g.pressedStyle,onClick:l},void 0,o()(d.FormattedMessage,{id:"connectedAppSettingsDiscoverItem.connectButton.label",defaultMessage:"Connect"})))))}},70578:(e,t,n)=>{n.d(t,{Z:()=>f});var i=n(23174),o=n.n(i),a=n(67294),s=n(480),r=n(9999),l=n(84169),c=n(5366),d=n(89101),g=n(50906),u=n(18514),p=n(16354),m=n(89728);function f(){window.__c={n:"ConnectionsSettingsLinks"};const e=(0,s.O7)();return a.createElement(a.Fragment,null,o()(p.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:`${d._j.integrations}/all`,external:!0,onClick:()=>{g.uyp(e,{from:"integration-settings",href:`${d._j.integrations}/all`})}},void 0,o()(m.Z,{icon:r.J,isSmall:!0,isLightGray:!0},void 0,o()(c.FormattedMessage,{id:"connectionsSettingsLinks.connectionsGallery",defaultMessage:"Browse connections in Gallery"}))),o()(p.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:d._j.myIntegrations,external:!0,onClick:()=>{g.YYl(e,{from:"integration-settings",href:d._j.myIntegrations})}},void 0,o()(m.Z,{icon:r.J,isSmall:!0,isLightGray:!0},void 0,o()(c.FormattedMessage,{id:"connectionsSettingsLinks.manageConnections",defaultMessage:"Develop or manage integrations"}))),o()(p.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:(0,u.UY)("guides.publicAPI"),external:!0},void 0,o()(m.Z,{icon:l.m,isSmall:!0,isLightGray:!0},void 0,o()(c.FormattedMessage,{id:"connectionsSettingsLinks.helpCenter",defaultMessage:"Learn more about connections"}))))}},38493:(e,t,n)=>{n.d(t,{Z:()=>Ae,O:()=>Ze});var i=n(23174),o=n.n(i),a=(n(57658),n(67294)),s=n(83355),r=n(41892),l=n(15070),c=n(77657),d=n(74181),g=n(72126),u=n(77420),p=n(15047),m=n(90965),f=n(97880),v=n(5366),h=n(50906),y=n(54642),S=n(515),b=n(64002),M=n(47307),I=n(95477),w=n(68821),C=n(91924),Z=n(46190),A=n(47593),k=n(92625),P=n(15356);const T=(0,v.defineMessages)({authenticatingWithAsana:{id:"asanaActions.authenticatingWithAsana.loadingMessage",defaultMessage:"Authenticating with Asana…"},titleMessage:{defaultMessage:"Asana login",id:"asanaActions.loginWithAsanaPopupModal.title"}});var _=n(76463),N=n(22711),F=n(91584),B=n(83805),D=n(42631),E=n(52192),x=n(61202);var L=n(38755),U=n(34859),R=n(80444),V=n(88632),K=n(30874),W=n(57559),O=n(72087),q=n(78291),z=n(94512),j=n(70578),G=n(68785),H=n(77137),$=n(53336),J=n(64369),Y=n(27386),Q=n(23189),X=n(31278),ee=n(40235),te=n(10434),ne=n.n(te),ie=n(480),oe=n(86628),ae=n(49085),se=n(8848),re=n(87279),le=n(25225),ce=n(24736),de=n(73084),ge=n(42922),ue=n(52275),pe=n(31945),me=n(78140),fe=n(32163),ve=n(63296),he=n(72495),ye=n(42782);function Se(e){window.__c={n:"UserConnectionsSettingsActionMenu"};const{botId:t,canSelectPageAccess:n,onConnect:i,onDisconnect:s}=e,[r,l]=(0,a.useState)(!1),[c]=(0,a.useState)(ae.default.createValue({})),d=(0,oe.VK)((()=>R.default.state.currentSpaceStore),[]),g=(0,ie.O7)(),p=(0,ie.Fy)(),{data:m}=(0,oe.VK)((()=>q.default.state),[]),f=[];if(n){const e=(m?(0,le.NM)(m):[]).find((e=>e.botId===t)),n=(null==e?void 0:e.pageIds.reduce(((e,t)=>(e[t]=!0,e)),{}))??{};d&&(r||(c.setState(n),l(!0)),f.push({key:"actions for user guest connections",render:e=>a.createElement(he.Z,e),items:[{key:"update selected pages",render:(e,i)=>a.createElement(ye.Z,ne()({},e,{onFocus:i.onFocus,disableDefaultClick:!0,renderOrigin:e=>a.createElement(ue.Z,ne()({},e,{title:o()(v.FormattedMessage,{id:"userConnectionsSettings.actionMenu.selectPages.label",defaultMessage:"Access selected pages"})})),renderExtension:(e,i)=>{return o()("div",{style:{width:400,padding:20}},void 0,o()(de.Z,{selectedBlockIdsStore:c}),(a={leftText:o()(v.FormattedMessage,{id:"userConnectionsSettings.actionMenu.pagePicker.cancel",defaultMessage:"Cancel"}),leftAction:()=>{c.setState(n),i.close()},rightText:o()(v.FormattedMessage,{id:"userConnectionsSettings.actionMenu.pagePicker.update",defaultMessage:"Update access"}),rightAction:()=>{!function(e){const{botId:t,currentSpaceStore:n,environment:i,selectedBlockIdsStore:o,currentAccessedPages:a}=e,s=[],r=[],l=o.state;Object.keys(l).forEach((e=>{a.hasOwnProperty(e)&&!l[e]?s.push(e):!a.hasOwnProperty(e)&&l[e]&&r.push(e)}));const c=W.t1.createChildStore(n,{table:u.cZ,id:t});_.jX({environment:i,currentSpaceStore:n,botStore:c,pages:s}),_.jX({environment:i,currentSpaceStore:n,botStore:c,pages:r,addPermission:!0})}({selectedBlockIdsStore:c,environment:g,currentSpaceStore:d,botId:t,currentAccessedPages:n}),i.close()}},o()("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:24}},void 0,o()(ve.Z,{isLarge:!0,onClick:a.leftAction,style:{height:32}},void 0,a.leftText),o()(ge.Z,{isLarge:!0,onClick:a.rightAction},void 0,a.rightText))));var a}})),action:()=>{}}]}))}const h=[];return i&&h.push({key:"connect account",render:e=>a.createElement(ue.Z,ne()({},e,{title:o()(v.FormattedMessage,{id:"userConnectionsSettings.actionMenu.connectAccount.label",defaultMessage:"Connect another account"}),onClick:i})),action:i}),h.push({key:"disconnect account",render:e=>a.createElement(ue.Z,ne()({},e,{title:o()("div",{style:{color:se.ZP.red}},void 0,o()(v.FormattedMessage,{id:"userConnectionsSettings.actionMenu.disconnectAccount.label",defaultMessage:"Disconnect account"})),onClick:()=>{s()}})),action:()=>s()}),f.push({key:"actions for all user connections",render:e=>a.createElement(he.Z,e),items:h}),o()(pe.ZP,{popupType:p.isMobile?pe.Z4.SlideUp:pe.Z4.Popup,renderOrigin:e=>a.createElement(ce.Z,ne()({},e,{isMobile:p.isMobile})),render:()=>o()(me.Z,{menuType:p.isMobile?re.og.ActionSheet:re.og.Popup},void 0,o()(fe.Z,{type:fe.i.Vertical,sections:f,initialFocus:void 0}))})}function be(e){const{userConnections:t}=e;return o()(ee.Z,{columns:[{key:"connection",header:o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"40%"}},{key:"access",header:o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.title",defaultMessage:"Access"}),style:{width:"40%"}},{key:"more",header:void 0,style:{width:"5%"}}],rows:Me(t)})}function Me(e){const t=[];return e.forEach((e=>{const{account:n,onDisconnect:i}=e;if(Array.isArray(n)){const o=n.map((t=>Ie({connection:{...e,onDisconnect:()=>{i(t)}},account:t})));t.push(...o)}else t.push(Ie({connection:e,account:n}))})),t}function Ie(e){const{account:t,connection:{id:n,appName:i,canSelectPageAccess:a,capabilities:s,logo:r,onConnect:l,onDisconnect:c}}=e,d=void 0!==t&&"string"!=typeof t,g=d?t.accountName:t,u=d?t.accountId:n;return{key:`${n}-${g}`,columns:[o()(we,{accountName:g,connectionLogo:r,connectionName:i},"connection-title"),s,o()(Se,{botId:u,canSelectPageAccess:a,connectionName:i,onConnect:l,onDisconnect:c},"connection-action-menu")]}}function we(e){const{accountName:t,connectionLogo:n,connectionName:i}=e;return o()("div",{style:{display:"flex",alignItems:"center",marginRight:12}},void 0,"string"==typeof n?o()("img",{src:n,style:{height:28}}):o()(X.Z,{disabled:!0,icon:n,title:i,isEmptyPage:!1,size:28,isLarge:!0,useInvertedColors:!0}),o()("div",{style:{marginLeft:15}},void 0,o()(J.Z,{},void 0,i),t&&o()(J.Z,{isSmall:!0},void 0,t)))}class Ce extends s.Z{constructor(){super(...arguments),this.storeTypes={requestStore:O.Z},this.loadConnections=async e=>{const{currentSpaceStore:t}=R.default.state;return{guestBotIds:await this.fetchUserGuestBotIds(),connectionStatus:await N.LN(e,null==t?void 0:t.id)}},this.fetchUserGuestBotIds=async()=>{const{currentSpaceStore:e,currentUserStore:t}=R.default.state;if(!e||!t||!q.default.state.data)return[];return(await _.Yw({environment:this.environment,table:p.bx,id:e.id,type:"guest"})).botIds.filter((n=>W.t1.createChildStore(e,{table:u.cZ,id:n}).getCreatedById()===t.id))}}renderComponent(){return V.Z.state.online?o()(H.Z,{request:this.environment,performRequest:this.loadConnections,requestStore:this.stores.requestStore,render:(e,t)=>null!=t&&t.connectionStatus?this.renderConnectedAppsSettings(t.guestBotIds):o()("div",{style:Ce.loadingWrapStyle},void 0,o()(G.Z,{}))}):this.renderOfflineMessage()}renderOfflineMessage(){return o()(Y.Z,{},void 0,o()(J.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,o()(v.FormattedMessage,{id:"connectedAppsSettings.offline.message",defaultMessage:"Please go online to manage connecting to apps."})))}renderConnectedAppsSettings(e){const{connected:t,discover:n}=this.getAppsByCategory(e),i=t.length>0;return o()("div",{style:this.getWrapStyle()},void 0,o()($.Z,{style:Ce.scrollerStyle,type:U.Z.Y},void 0,i&&a.createElement(a.Fragment,null,o()(Q.Z,{large:!0,divider:"full",style:{borderBottom:"none",marginBottom:0}},void 0,o()(v.FormattedMessage,{id:"connectionsSettings.connectionsSection.title",defaultMessage:"My connections"})),o()(be,{userConnections:t})),o()("div",{style:{marginTop:i?32:void 0}},void 0,o()(z.Z,{apps:n,numberOfConnectedApps:t.length,showSubtitle:!1})),o()("div",{style:{marginTop:8}},void 0,o()(j.Z,{}))))}async handleDriveAuth(){h.SOV(this.environment,{integration_name:"google",from:"connected_apps"}),await F.qN(this.environment),await N.LN(this.environment),await this.stores.requestStore.refresh()}handleDisconnectDrive(e){const{intl:t}=this.props;M.showDialog({message:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.message",defaultMessage:"Disconnecting disables file preview on Google Drive files embedded in all of your workspaces. It would not delete your embeds from Notion, so you can re-connect at anytime."}),showCancel:!0,keepFocus:!0,items:[{label:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.disconnectButton.label",defaultMessage:"Disconnect"}),color:"red",onAccept:async()=>{await y.disconnectDrive(this.environment,{googleUserId:e.accountId}),await N.LN(this.environment),await this.stores.requestStore.refresh()}}]})}getAppsByCategory(e){const t=g.vM([...this.getExternalIntegrations(),...this.getLegacyConnectedApps()],(e=>e.account&&e.account.length>0?"connected":"discover"));return{connected:[...this.getUserGuestIntegrations(e),...t.connected||[]],discover:t.discover||[]}}shouldShowGoogleDriveLegacyApp(){const{integrations:{state:e}}=K.Z;return!e.some((e=>e.id===c.f3))}getLegacyConnectedApps(){var e;const{intl:t}=this.props,n=this.stores.requestStore;let i=!1;const{currentSpaceStore:a}=R.default.state,s=null===(e=n.state.result)||void 0===e?void 0:e.connectionStatus,l=(null==s?void 0:s.drive)&&(null==s?void 0:s.drive.length)>0,c=this.shouldShowGoogleDriveLegacyApp();if(c){const e=null==a?void 0:a.getBotSettingsStore().getValue();i=!(0,m.CJ)(e)||Boolean((null==e?void 0:e.integration_approval_statuses)&&e.integration_approval_statuses[d._o])}const g=o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.legacyImporter",defaultMessage:"Can only add pages"});return[...c&&(i||l)?[{id:"drive",appName:"Google Drive",caption:t.formatMessage({id:"connectedAppsSettings.googleDrive.caption",defaultMessage:"Find and embed your files."}),shouldHideConnectAccount:!i,shouldHideInDiscover:!c,logo:r.Z.images.import.googleDrivePng,account:null==s?void 0:s.drive,capabilities:o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.googleDrive",defaultMessage:"Can embed content"}),canSelectPageAccess:!1,onConnect:()=>this.handleDriveAuth(),onDisconnect:e=>{e&&this.handleDisconnectDrive(e)}}]:[],{id:"evernote",appName:"Evernote",caption:t.formatMessage({id:"connectedAppsSettings.evernote.caption",defaultMessage:"Import notebooks."}),logo:r.Z.images.import.evernotePng,account:null==s?void 0:s.evernote,capabilities:g,canSelectPageAccess:!1,integrationTypes:["importer"],onConnect:()=>B.e({environment:this.environment,requestStore:n}),onDisconnect:()=>N.Lm(this.environment,n)},{id:"trello",appName:"Trello",caption:t.formatMessage({id:"connectedAppsSettings.trello.caption",defaultMessage:"Import your boards."}),logo:r.Z.images.import.trelloPng,shouldHideInDiscover:!0,account:null==s?void 0:s.trello,capabilities:g,integrationTypes:["importer"],canSelectPageAccess:!1,onConnect:()=>E.M({environment:this.environment,requestStore:n}),onDisconnect:()=>N.C(this.environment,n)},{id:"asana",appName:"Asana",caption:t.formatMessage({id:"connectedAppsSettings.asana.caption",defaultMessage:"Import tasks from boards and lists."}),logo:r.Z.images.import.asanaPng,shouldHideInDiscover:!0,integrationTypes:["importer"],account:null==s?void 0:s.asana,capabilities:g,canSelectPageAccess:!1,onConnect:()=>async function(e){const{environment:t,requestStore:n}=e,i=(0,C.eC)(t);let o=(0,S.s1)(I.default.domainBaseUrl,{authType:i,userId:t.currentUser.id});o=i.redirectToAuth?o:await(0,C.HU)(t,o);const a=await P.M(t,{width:580,height:800,url:o,titleMessage:T.titleMessage});if(!a)return;const s=b.Qc(a);if(!s.query.code||!s.query.state)return;k.j({message:T.authenticatingWithAsana});const r=await y.authWithAsana(t,{code:s.query.code,encryptedState:s.query.state});"failed"===r.type?(console.error(r.error),M.showError(r),k.x()):(h.L3B(t,{integration_name:"asana"}),await n.refresh(),Z.Z.setState({open:!0}),(0,w.c)()||A.Z.setState({open:!0}),k.x())}({environment:this.environment,requestStore:n}),onDisconnect:()=>N.Ow(this.environment,n)},...null!=a&&a.id?[{id:"confluence",appName:"Confluence",caption:t.formatMessage({id:"connectedAppsSettings.confluence.caption",defaultMessage:"Import Spaces from Confluence."}),logo:r.Z.images.import.confluencePng,shouldHideInDiscover:!0,account:null==s?void 0:s.confluence,capabilities:g,integrationTypes:["importer"],canSelectPageAccess:!1,onDisconnect:()=>N.DP(this.environment,n,a.id)}]:[]]}getUserGuestIntegrations(e){const{currentSpaceStore:t}=R.default.state;if(!t||(0,L.Cx)(t))return[];return e.map((e=>{const n=W.t1.createChildStore(t,{table:u.cZ,id:e}),i=n.getName(),a=n.getIntegrationId();if(!n.getAlive()||!i||!a)return;const s=n.getIntegrationPointer(),r=n.getIcon(),l=r&&s?{pointer:s,icon:r}:void 0;return{id:n.id,appName:i,caption:void 0,account:void 0,logo:l,capabilities:o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.userGuest",defaultMessage:"Can {capabilities} content",values:{capabilities:o()(v.FormattedList,{value:Ze(n.getCapabilities()),type:"conjunction"})}}),canSelectPageAccess:!0,onDisconnect:async()=>{await M.confirmUserAction({message:o()("span",{},void 0,o()(v.FormattedMessage,{id:"userConnectionsSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for this account?"})),acceptLabel:o()(v.FormattedMessage,{id:"userConnectionsSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})})&&await _.P0({environment:this.environment,botId:n.id,onSuccess:()=>{}})}}})).filter(f.$K)}getExternalBotCapabilities(e){const t=[o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.previewLinks",defaultMessage:"preview links"},"previewLinks")];return function(e){return!!e.info.original_url_patterns&&e.info.original_url_patterns.some((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection}))}(e)&&t.push(o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.syncDatabases",defaultMessage:"sync databases"},"syncedDatabase")),t}getExternalIntegrations(){const{currentSpaceStore:e}=R.default.state;if(!e||!e.canEdit())return[];const t=e.getBotSettingsStore().getValue(),n=e.id,{integrations:{state:i},bots:{state:s},externalAuthentications:{state:r}}=K.Z,p=e.canAdmin(),y=c.Gw,S={[c.U9]:1,[y]:2};i.sort(((e,t)=>(S[e.id]??1/0)-(S[t.id]??1/0)));const b=[c.U9];return i.map((i=>{if(!i.info.icon)return;if(!p&&b.includes(i.id))return;const f=s.filter((e=>e.integration_id===i.id)),y=g.oA(f.map((e=>{const t=r.find((t=>t.parent_id===e.id));if(t)return{accountId:e.id,accountName:t.account_name}}))),S=(0,m.hU)({spaceBotSettings:t,integrationId:i.id,env:"production"}),I=y.length>0;if(!S&&!I)return;if(!I&&i.id===c.Dv)return;const w=!S,C=o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.external",defaultMessage:"Can {capabilities}",values:{capabilities:o()(v.FormattedList,{value:this.getExternalBotCapabilities(i),type:"conjunction"})}}),Z=(0,l.ms)(i.capabilities),A=i.capabilities.inherit_creator_permissions,k=Z&&!A,P=[];return(0,d.mo)(i)&&P.push("linkPreview"),(0,d.zc)(i)&&P.push("databaseSync"),{id:i.id,appName:i.name,caption:i.info.tagline,logo:i.info.icon,account:y,shouldHideConnectAccount:w,shouldShowNewBadge:!i.info.hide_new_badge,integrationTypes:P,capabilities:a.createElement(a.Fragment,null,o()("div",{},void 0,C),Z?o()("div",{},void 0,o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.externalWithCapabilities",defaultMessage:"Can {capabilities} content",values:{capabilities:o()(v.FormattedList,{value:Ze(i.capabilities),type:"conjunction"})}})):null),canSelectPageAccess:k,onConnect:async()=>{await D.hM({environment:this.environment,integration:i,spaceId:n,from:"connected_apps_settings"}),x.pJ({environment:this.environment})},onDisconnect:async t=>{const n=s.find((e=>e.id===(null==t?void 0:t.accountId)));if(n){const a=W.t1.createChildStore(e,{table:u.cZ,id:n.id,spaceId:n.space_id}),s=null!=t&&t.accountName?o()(v.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.withAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for {accountName}?",values:{accountName:t.accountName}}):o()(v.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for this account?"});await M.confirmUserAction({message:o()("span",{},void 0,s),acceptLabel:o()(v.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})})&&(await _.P0({environment:this.environment,botId:a.id,onSuccess:()=>{}}),h.lLm(this.environment,{integrationId:i.id}))}}}})).filter(f.$K)}getWrapStyle(){return{display:"flex",flexDirection:"column",height:"100%",width:"sidebar-modal"===this.props.location?"100%":"auto"}}}function Ze(e){const t=[];return null!=e&&e.read_content&&t.push(o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.readContent",defaultMessage:"view"})),null!=e&&e.insert_content&&t.push(o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.insertContent",defaultMessage:"insert"})),null!=e&&e.update_content&&t.push(o()(v.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.updateContent",defaultMessage:"update"})),t}Ce.displayName="UserConnectionsSettings",Ce.loadingWrapStyle={alignItems:"center",display:"flex",flexDirection:"column",flex:1,height:"100%",justifyContent:"center"},Ce.scrollerStyle={height:"100%",padding:"36px 60px"};const Ae=(0,v.injectIntl)(Ce)},41623:(e,t,n)=>{n.d(t,{Nq:()=>o,f_:()=>a,yh:()=>s});var i=n(15070);function o(e,t){const n=t.getAlive(),o=(0,i.hA)(t),a=Boolean(!t.getIntegrationId()),s=Boolean(t.getIntegrationId()),r=Boolean(e.currentUser.id===t.getParentId());return n&&o&&(s&&r||a)}function a(e){return e.getAlive()&&(0,i.hA)(e)&&Boolean(e.getIntegrationId())}function s(e){const{externalIntegrationStoreState:t,integrationId:n}=e;if(!t.loaded)return;const o=t.externalAuthentications.map((e=>{let{parent_id:t}=e;return t})),a=new Set(o),s=t.bots.filter((e=>e.alive&&a.has(e.id)&&(0,i.U9)(e)&&e.integration_id===n));return s.length?s[0]:void 0}},74021:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(49085);class o extends i.default{getInitialState(){return{open:!1}}}const a=new o},53833:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(49085);class o extends i.default{getInitialState(){return{notebooksResponse:{notebooks:[]},isFetchingNotebooks:!0,showLoader:!1}}}const a=new o},46190:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)},90365:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)},82066:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)},81676:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(49085);class o extends i.default{getInitialState(){return{boardsResponse:{boards:[]},isFetchingBoards:!0,showLoader:!1}}}const a=new o},80920:(e,t,n)=>{n.d(t,{X:()=>a});var i=n(23174),o=n.n(i);n(67294);const a=(0,n(45238).I)("integrationSecurity",{viewBox:"0 0 16 16",svg:o()("path",{d:"M7.996 16c.152 0 .37-.056.59-.16C13.407 13.481 15 12.242 15 9.38V3.421c0-.927-.38-1.263-1.205-1.59-.919-.36-4.03-1.408-4.931-1.696A3.17 3.17 0 0 0 7.996 0c-.278 0-.59.064-.86.136-.91.272-4.012 1.335-4.93 1.695C1.378 2.151 1 2.495 1 3.422V9.38c0 2.863 1.66 3.99 6.414 6.461.22.112.439.16.582.16Zm-.936-4.398c-.32 0-.573-.128-.817-.424L4.178 8.796a.86.86 0 0 1-.228-.568c0-.408.346-.744.775-.744.262 0 .464.096.683.352l1.627 1.96 3.481-5.294c.185-.272.421-.416.683-.416.421 0 .809.28.809.696 0 .184-.101.383-.22.56l-3.952 5.836a.915.915 0 0 1-.776.424Z"})})}}]);